<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>LEDGER ‚Äî Personal Finance Tracker</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Serif+Display:ital@0;1&family=Manrope:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --ink:   #0D0D0D;
  --paper: #F2EDE4;
  --off:   #FAF7F2;
  --rule:  #D4C9BC;
  --muted: #7A7065;
  --red:   #C8321A;
  --green: #1E4D2B;
  --lime:  #A8C84A;
  --gold:  #D4A017;
  --blue:  #1A3A6B;
  --mid:   #EDE8DF;
  --masthead-h: 58px;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; -webkit-text-size-adjust: 100%; }
body { font-family: 'Manrope', sans-serif; background: var(--paper); color: var(--ink); min-height: 100vh; overscroll-behavior: none; }

/* ‚îÄ‚îÄ MASTHEAD (from ledger 10) ‚îÄ‚îÄ */
.masthead {
  background: var(--ink);
  border-bottom: 4px solid var(--gold);
  display: flex;
  align-items: stretch;
  position: sticky;
  top: 0;
  z-index: 200;
  height: var(--masthead-h);
}
.m-logo { font-family: 'Bebas Neue', sans-serif; font-size: 2rem; color: var(--paper); padding: 0 1.75rem; border-right: 2px solid #222; letter-spacing: 0.08em; display: flex; align-items: center; }
.m-logo .star { color: var(--gold); font-size: 1.1rem; margin: 0 0.1rem; }
.m-tag { font-size: 0.6rem; font-weight: 600; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); padding: 0 1.25rem; display: flex; align-items: center; border-right: 1px solid #222; }
.m-period { display: flex; align-items: center; gap: 0.4rem; padding: 0 1rem; border-right: 1px solid #222; }
.period-arrow { background: none; border: 1px solid #333; color: var(--muted); width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.75rem; transition: all 0.15s; flex-shrink: 0; touch-action: manipulation; }
.period-arrow:hover { border-color: var(--gold); color: var(--gold); }
.period-label { font-family: 'Bebas Neue', sans-serif; font-size: 1rem; color: var(--paper); letter-spacing: 0.06em; min-width: 120px; text-align: center; }
.period-mode { display: flex; }
.pmode-btn { background: none; border: 1px solid #333; color: #555; font-size: 0.56rem; font-weight: 700; letter-spacing: 0.12em; text-transform: uppercase; padding: 0.22rem 0.5rem; cursor: pointer; transition: all 0.15s; font-family: 'Manrope', sans-serif; touch-action: manipulation; }
.pmode-btn + .pmode-btn { border-left: none; }
.pmode-btn.active { background: var(--gold); color: var(--ink); border-color: var(--gold); }
.m-balance { margin-left: auto; display: flex; align-items: center; border-left: 2px solid #222; padding: 0 1.75rem; gap: 0.75rem; }
.m-balance-label { font-size: 0.56rem; font-weight: 600; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted); }
.m-balance-num { font-family: 'Bebas Neue', sans-serif; font-size: 1.6rem; letter-spacing: 0.04em; color: var(--lime); line-height: 1; transition: color 0.3s; }
.m-balance-num.neg { color: var(--red); }

/* ‚îÄ‚îÄ HERO (from ledger 10) ‚îÄ‚îÄ */
.hero { background: var(--ink); display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; }
.hero-col { padding: 1.4rem 1.75rem; border-right: 1px solid #1e1e1e; position: relative; overflow: hidden; }
.hero-col:last-child { border-right: none; }
.h-label { font-size: 0.56rem; font-weight: 600; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); margin-bottom: 0.3rem; }
.h-num { font-family: 'Bebas Neue', sans-serif; font-size: 2.4rem; line-height: 1; letter-spacing: 0.02em; }
.h-num.income { color: var(--lime); }
.h-num.expense { color: var(--red); }
.h-num.net.pos { color: var(--paper); }
.h-num.net.neg { color: var(--red); }
.h-num.budget-stat { color: var(--gold); }
.h-sub { font-size: 0.62rem; font-weight: 500; color: #555; margin-top: 0.3rem; }
.h-sub.over { color: var(--red); }
.h-sub.under { color: var(--lime); }

/* ‚îÄ‚îÄ LAYOUT (from ledger 10) ‚îÄ‚îÄ */
.layout { display: grid; grid-template-columns: 1fr 400px; }

/* ‚îÄ‚îÄ LEFT COL ‚îÄ‚îÄ */
.ledger-col { border-right: 2px solid var(--ink); }

/* ‚îÄ‚îÄ COL HEADER (from ledger 9 ‚Äî controls not cut off) ‚îÄ‚îÄ */
.col-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1.5rem;
  border-bottom: 2px solid var(--ink);
  background: var(--paper);
  gap: 0.6rem;
  overflow: visible;
}
.col-hed { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; letter-spacing: 0.06em; display: flex; align-items: center; gap: 0.55rem; white-space: nowrap; }
.count-pill { font-size: 0.62rem; font-weight: 700; background: var(--ink); color: var(--paper); padding: 0.2rem 0.6rem; border-radius: 2px; }
.col-controls { display: flex; align-items: center; gap: 0.45rem; flex-shrink: 0; }

/* Controls from ledger 9 ‚Äî fixed height, flex-centered, no cutoff */
.ctrl-select,
.ctrl-btn {
  font-family: 'Manrope', sans-serif;
  font-size: 0.68rem;
  font-weight: 600;
  background: var(--paper);
  border: 1px solid var(--rule);
  color: var(--muted);
  padding: 0.38rem 0.6rem;
  cursor: pointer;
  outline: none;
  white-space: nowrap;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  touch-action: manipulation;
  border-radius: 0;
  line-height: 1.4;
  transition: all 0.15s;
  vertical-align: middle;
}
.ctrl-select {
  appearance: none;
  -webkit-appearance: none;
  padding-right: 1.6rem;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='9' height='5' viewBox='0 0 9 5'%3E%3Cpath d='M0 0l4.5 5L9 0z' fill='%237A7065'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 0.5rem center;
  background-size: 8px 5px;
  background-color: var(--paper);
}
.ctrl-btn:hover { border-color: var(--ink); color: var(--ink); }

/* ‚îÄ‚îÄ TABLE (from ledger 10 styling, ledger 9 dimmed rows) ‚îÄ‚îÄ */
.tx-table { width: 100%; border-collapse: collapse; }
.tx-table thead th {
  font-size: 0.58rem; font-weight: 700; letter-spacing: 0.14em; text-transform: uppercase;
  color: var(--muted); padding: 0.5rem 1rem; text-align: left;
  border-bottom: 1px solid var(--rule); background: var(--off);
}
.tx-table thead th:last-child { text-align: right; padding-right: 2rem; }
.tx-table thead th:first-child { padding-left: 2rem; }

.tx-row { border-bottom: 1px solid var(--rule); cursor: pointer; transition: background 0.12s; animation: rowIn 0.3s ease both; }
.tx-row:hover { background: var(--mid); }
.tx-row.selected { background: var(--ink); color: var(--paper); }
.tx-row.dimmed { opacity: 0.42; }
.tx-row.dimmed:hover { opacity: 0.75; }
.tx-row td { padding: 0.75rem 1rem; vertical-align: middle; }
.tx-row td:first-child { padding-left: 2rem; }
.tx-row td:last-child { padding-right: 2rem; text-align: right; }

.tx-date { font-size: 0.7rem; font-weight: 500; color: var(--muted); white-space: nowrap; }
.tx-row.selected .tx-date { color: #888; }

.tx-divider td { padding: 0.3rem 2rem; font-size: 0.55rem; font-weight: 700; letter-spacing: 0.15em; text-transform: uppercase; color: var(--gold); background: var(--off); border-bottom: 1px solid var(--rule); }

/* ‚îÄ‚îÄ CATEGORY TAGS (from ledger 10) ‚îÄ‚îÄ */
.tx-cat {
  display: inline-flex; align-items: center; gap: 0.35rem;
  font-size: 0.6rem; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase;
  padding: 0.16rem 0.5rem; border: 1px solid currentColor;
}
.tx-cat-icon { font-size: 0.85rem; line-height: 1; }

.tx-desc { font-size: 0.88rem; font-weight: 600; line-height: 1.2; font-family: 'Manrope', sans-serif; }
.tx-note { font-size: 0.7rem; font-weight: 400; color: var(--muted); font-style: italic; margin-top: 2px; }
.tx-row.selected .tx-note { color: #888; }

.tx-amount { font-family: 'Bebas Neue', sans-serif; font-size: 1.2rem; letter-spacing: 0.03em; white-space: nowrap; }
.tx-amount.inc { color: var(--lime); }
.tx-amount.exp { color: var(--red); }
.tx-row.selected .tx-amount.inc { color: var(--lime); }
.tx-row.selected .tx-amount.exp { color: #ff7766; }

/* Category tag colors */
.cat-food      { color: var(--gold);  border-color: var(--gold);  background: rgba(212,160,23,0.1); }
.cat-transport { color: #4A7DBF;      border-color: #4A7DBF;      background: rgba(74,125,191,0.1); }
.cat-home      { color: #B5783C;      border-color: #B5783C;      background: rgba(181,120,60,0.1); }
.cat-health    { color: #3DA882;      border-color: #3DA882;      background: rgba(61,168,130,0.1); }
.cat-income    { color: #4CAF50;      border-color: #4CAF50;      background: rgba(76,175,80,0.1); }
.cat-leisure   { color: #A86FD4;      border-color: #A86FD4;      background: rgba(168,111,212,0.1); }
.cat-shopping  { color: var(--red);   border-color: var(--red);   background: rgba(200,50,26,0.1); }
.cat-savings   { color: #3A8FBF;      border-color: #3A8FBF;      background: rgba(58,143,191,0.1); }
.cat-other     { color: var(--muted); border-color: var(--muted); background: rgba(122,112,101,0.1); }

.tx-row.selected .tx-cat { background: rgba(255,255,255,0.12) !important; border-color: rgba(255,255,255,0.35) !important; color: rgba(255,255,255,0.85) !important; }

.empty-state { padding: 4rem 2rem; text-align: center; display: none; }
.empty-state.show { display: block; }
.empty-hed { font-family: 'DM Serif Display', serif; font-size: 2rem; margin-bottom: 0.5rem; }
.empty-sub { font-size: 0.85rem; color: var(--muted); font-style: italic; }

/* ‚îÄ‚îÄ RIGHT PANEL (from ledger 10) ‚îÄ‚îÄ */
.right-col {
  background: var(--off);
  display: flex;
  flex-direction: column;
  position: sticky;
  top: var(--masthead-h);
  height: calc(100vh - var(--masthead-h));
  overflow: hidden;
  align-self: start;
}

.right-tabs {
  display: flex;
  background: var(--ink);
  border-bottom: 2px solid #1a1a1a;
  flex-shrink: 0;
}
.rtab {
  flex: 1; font-size: 0.64rem; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase;
  padding: 0.7rem 0.5rem; text-align: center; cursor: pointer; color: #555;
  border: none; background: none; transition: all 0.15s; border-bottom: 3px solid transparent;
  font-family: 'Manrope', sans-serif; touch-action: manipulation;
}
.rtab.active { color: var(--gold); border-bottom-color: var(--gold); }
.rtab:hover:not(.active) { color: #888; }

.tab-panel { display: none; flex-direction: column; flex: 1; overflow: hidden; }
.tab-panel.active { display: flex; }

.tab-scroll { flex: 1; overflow-y: auto; overflow-x: hidden; }
.tab-scroll::-webkit-scrollbar { width: 3px; }
.tab-scroll::-webkit-scrollbar-thumb { background: var(--rule); }

.budget-save-bar {
  flex-shrink: 0;
  padding: 0.85rem 1rem;
  border-top: 2px solid var(--rule);
  background: var(--off);
}
.budget-save-btn {
  width: 100%; background: var(--green); border: none; color: white;
  font-family: 'Bebas Neue', sans-serif; font-size: 1.05rem; letter-spacing: 0.1em;
  padding: 0.6rem; cursor: pointer; transition: all 0.15s;
}
.budget-save-btn:hover { background: var(--ink); }

/* ‚îÄ‚îÄ ADD FORM (from ledger 10) ‚îÄ‚îÄ */
.add-form { padding: 1.1rem 1.5rem 1rem; }
.form-hed { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; color: var(--ink); letter-spacing: 0.08em; margin-bottom: 0.8rem; display: flex; align-items: center; gap: 0.5rem; }
.form-hed .gold { color: var(--gold); }
.type-toggle { display: flex; margin-bottom: 0.8rem; border: 1px solid var(--rule); }
.type-btn { flex: 1; font-size: 0.66rem; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; padding: 0.5rem; background: none; border: none; color: var(--muted); cursor: pointer; transition: all 0.15s; font-family: 'Manrope', sans-serif; touch-action: manipulation; }
.type-btn.active.exp { background: var(--red); color: white; }
.type-btn.active.inc { background: var(--lime); color: var(--ink); }
.form-row { margin-bottom: 0.55rem; }
.form-label { font-size: 0.56rem; font-weight: 700; letter-spacing: 0.16em; text-transform: uppercase; color: var(--muted); display: block; margin-bottom: 0.25rem; }
.form-input, .form-select {
  width: 100%; background: white; border: 1.5px solid var(--rule); color: var(--ink);
  font-family: 'Manrope', sans-serif; font-size: 0.84rem; font-weight: 500;
  outline: none; transition: border-color 0.15s; appearance: none; -webkit-appearance: none; border-radius: 0;
  box-sizing: border-box;
}
.form-input {
  height: 42px;
  padding: 0 0.8rem;
  line-height: 42px;
}
.form-select {
  padding: 0.7rem 2rem 0.7rem 0.8rem;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='9' height='5' viewBox='0 0 9 5'%3E%3Cpath d='M0 0l4.5 5L9 0z' fill='%237A7065'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 0.7rem center; background-size: 9px;
  background-color: white;
}
.form-input:focus, .form-select:focus { border-color: var(--ink); }
.form-input::placeholder { color: #bbb; }
.form-select option { background: white; color: var(--ink); }
input[type="date"] { color-scheme: light; }
input[type="date"]::-webkit-calendar-picker-indicator {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%230D0D0D' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E");
  background-size: 13px; background-repeat: no-repeat; background-position: center;
  cursor: pointer; opacity: 0.5; width: 20px; height: 20px;
}

/* ‚îÄ‚îÄ CUSTOM DROPDOWN ‚îÄ‚îÄ */
.custom-select-wrap { position: relative; width: 100%; }
.custom-select-trigger {
  width: 100%; height: 42px; background: white; border: 1.5px solid var(--rule);
  color: var(--ink); font-family: 'Manrope', sans-serif; font-size: 0.84rem; font-weight: 500;
  padding: 0 2rem 0 0.8rem; display: flex; align-items: center; cursor: pointer;
  user-select: none; transition: border-color 0.15s; box-sizing: border-box;
  white-space: nowrap; overflow: hidden;
}
.custom-select-trigger.open { border-color: var(--ink); }
.custom-select-trigger.placeholder { color: #bbb; }
.custom-select-arrow {
  position: absolute; right: 0.7rem; top: 50%; transform: translateY(-50%);
  pointer-events: none; width: 9px; height: 5px;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='9' height='5' viewBox='0 0 9 5'%3E%3Cpath d='M0 0l4.5 5L9 0z' fill='%237A7065'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-size: contain;
}
.custom-select-opts {
  display: none; position: absolute; bottom: calc(100% + 2px); left: 0; right: 0;
  background: white; border: 1.5px solid var(--ink); z-index: 999;
  box-shadow: 0 -4px 16px rgba(0,0,0,0.12);
}
.custom-select-opts.open { display: block; }
.custom-select-opt {
  padding: 0.35rem 0.8rem; font-family: 'Manrope', sans-serif; font-size: 0.75rem;
  font-weight: 500; cursor: pointer; color: var(--ink); transition: background 0.1s;
}
.custom-select-opt:hover { background: var(--mid); }
.custom-select-opt.selected { background: var(--ink); color: var(--paper); }
.amount-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.55rem; }
.form-submit { width: 100%; margin-top: 0.6rem; background: var(--ink); border: none; color: var(--paper); font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 0.1em; padding: 0.65rem; cursor: pointer; transition: all 0.15s; }
.form-submit:hover { background: var(--gold); color: var(--ink); }

/* ‚îÄ‚îÄ BUDGET PANEL (from ledger 10) ‚îÄ‚îÄ */
.budget-panel { padding: 1rem 1rem 0; overflow: visible; }
.budget-intro { font-size: 0.75rem; color: var(--muted); line-height: 1.6; margin-bottom: 1rem; padding-bottom: 0.85rem; border-bottom: 1px solid var(--rule); }
.budget-intro em { font-style: italic; }

.budget-row { padding: 0.7rem 0; border-bottom: 1px solid var(--rule); }
.budget-row-top { display: flex; align-items: center; gap: 0.5rem; }
.budget-cat { display: flex; align-items: center; gap: 0.35rem; width: 110px; flex-shrink: 0; min-width: 0; }
.budget-cat-star { font-size: 1rem; flex-shrink: 0; line-height: 1; }
.budget-cat-name { font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; color: var(--ink); white-space: nowrap; overflow: visible; }
.budget-input-wrap { flex: 1; position: relative; min-width: 0; }
.budget-input-wrap span { position: absolute; left: 0.55rem; top: 50%; transform: translateY(-50%); font-size: 0.78rem; font-weight: 600; color: var(--muted); pointer-events: none; }
.budget-input { width: 100%; background: white; border: 1.5px solid var(--rule); color: var(--ink); font-family: 'Bebas Neue', sans-serif; font-size: 0.95rem; letter-spacing: 0.04em; padding: 0.35rem 0.5rem 0.35rem 1.3rem; outline: none; transition: border-color 0.15s; border-radius: 0; }
.budget-input:focus { border-color: var(--ink); }
.budget-status { width: 70px; text-align: right; flex-shrink: 0; }
.budget-status-num { font-family: 'Bebas Neue', sans-serif; font-size: 0.85rem; letter-spacing: 0.02em; display: block; line-height: 1.1; white-space: nowrap; }
.budget-status-num.over  { color: var(--red); }
.budget-status-num.under { color: var(--green); }
.budget-status-num.none  { color: var(--muted); }
.budget-status-label { font-size: 0.5rem; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; display: block; }
.budget-status-label.over  { color: var(--red); }
.budget-status-label.under { color: var(--green); }
.budget-status-label.none  { color: var(--muted); }
.budget-bar-wrap { margin-top: 0.4rem; }
.budget-track { height: 4px; background: var(--rule); width: 100%; }
.budget-fill { height: 100%; width: 0%; transition: width 0.7s cubic-bezier(0.16,1,0.3,1); max-width: 100%; }
.budget-bar-meta { display: flex; justify-content: space-between; margin-top: 3px; font-size: 0.56rem; font-weight: 600; color: var(--muted); }
.budget-bar-meta span { white-space: nowrap; }

/* ‚îÄ‚îÄ CHARTS (from ledger 10 layout, ledger 9 trend chart) ‚îÄ‚îÄ */
.charts-area { padding: 1.1rem 1.5rem; }
.chart-block { margin-bottom: 1.5rem; }
.chart-hed { font-size: 0.6rem; font-weight: 700; letter-spacing: 0.16em; text-transform: uppercase; color: var(--muted); border-bottom: 1px solid var(--rule); padding-bottom: 0.45rem; margin-bottom: 0.9rem; display: flex; align-items: center; justify-content: space-between; }
.cat-bar-row { display: flex; align-items: center; gap: 0.6rem; margin-bottom: 0.65rem; }
.cat-bar-label { font-size: 0.6rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; width: 65px; flex-shrink: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.cat-bar-track { flex: 1; height: 9px; background: var(--rule); }
.cat-bar-fill { height: 100%; transition: width 0.8s cubic-bezier(0.16,1,0.3,1); }
.cat-bar-right { font-size: 0.58rem; font-weight: 600; color: var(--muted); width: 68px; text-align: right; flex-shrink: 0; line-height: 1.4; }

/* ‚îÄ‚îÄ TREND CHART (from ledger 9) ‚îÄ‚îÄ */
.trend-chart {
  background: var(--mid);
  border: 1px solid var(--rule);
  padding: 0.9rem 0.85rem 0.7rem;
}
.trend-bars-row {
  display: flex;
  align-items: flex-end;
  gap: 4px;
  height: 88px;
  margin-bottom: 0;
}
.trend-month {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.trend-pair {
  display: flex;
  align-items: flex-end;
  gap: 2px;
  width: 100%;
  justify-content: center;
  height: 72px;
}
.trend-bar {
  flex: 1;
  max-width: 14px;
  border-radius: 2px 2px 0 0;
  min-height: 0;
  transition: height 0.6s cubic-bezier(0.16,1,0.3,1);
}
.trend-bar.inc { background: var(--lime); opacity: 0.85; }
.trend-bar.exp { background: var(--red); opacity: 0.72; }
.trend-rule { height: 1px; background: var(--rule); margin: 4px 0; width: 100%; }
.trend-lbl { font-size: 0.5rem; font-weight: 700; letter-spacing: 0.07em; text-transform: uppercase; color: var(--muted); text-align: center; }
.trend-legend { display: flex; gap: 1rem; margin-top: 0.55rem; }
.trend-legend-item { display: flex; align-items: center; gap: 0.3rem; font-size: 0.55rem; font-weight: 700; color: var(--muted); }
.trend-legend-dot { width: 8px; height: 8px; border-radius: 1px; flex-shrink: 0; }
.trend-empty { font-size: 0.78rem; color: var(--muted); font-style: italic; text-align: center; padding: 1.2rem 0; }

/* ‚îÄ‚îÄ HEALTH METER ‚îÄ‚îÄ */
.health-meter { background: var(--mid); border: 2px solid var(--ink); padding: 0.9rem; }
.health-top { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 0.65rem; }
.health-score { font-family: 'Bebas Neue', sans-serif; font-size: 3rem; color: var(--green); line-height: 1; transition: color 0.4s; }
.health-score.warn { color: var(--gold); }
.health-score.danger { color: var(--red); }
.health-label { font-size: 0.58rem; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; color: var(--muted); text-align: right; line-height: 1.6; }
.health-track { height: 7px; background: var(--rule); margin-bottom: 0.65rem; }
.health-fill { height: 100%; background: linear-gradient(90deg, var(--green), var(--lime)); transition: width 0.8s cubic-bezier(0.16,1,0.3,1), background 0.4s; }
.health-fill.warn { background: linear-gradient(90deg, var(--gold), #f0c040); }
.health-fill.danger { background: linear-gradient(90deg, var(--red), #e05040); }
.health-tips { font-size: 0.73rem; color: var(--muted); font-style: italic; line-height: 1.5; }

/* ‚îÄ‚îÄ QUICK STATS ‚îÄ‚îÄ */
.quick-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.6rem; }
.q-stat { background: var(--mid); padding: 0.8rem; border: 1px solid var(--rule); }
.q-stat-label { font-size: 0.54rem; font-weight: 700; letter-spacing: 0.16em; text-transform: uppercase; color: var(--muted); margin-bottom: 0.25rem; }
.q-stat-num { font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; }

/* ‚îÄ‚îÄ DRAWER (from ledger 10) ‚îÄ‚îÄ */
.drawer-overlay { position: fixed; inset: 0; z-index: 300; pointer-events: none; }
.drawer-overlay.open { pointer-events: all; }
.drawer-scrim { position: absolute; inset: 0; background: rgba(13,13,13,0.4); opacity: 0; transition: opacity 0.3s; }
.drawer-overlay.open .drawer-scrim { opacity: 1; }
.drawer { position: absolute; right: 0; top: 0; bottom: 0; width: min(460px, 100%); background: var(--paper); border-left: 3px solid var(--ink); transform: translateX(100%); transition: transform 0.35s cubic-bezier(0.16,1,0.3,1); overflow-y: auto; display: flex; flex-direction: column; }
.drawer-overlay.open .drawer { transform: translateX(0); }
.d-top { padding: 1.75rem; position: relative; border-bottom: 2px solid var(--ink); }
.d-close { position: absolute; top: 1rem; right: 1rem; background: none; border: 1px solid var(--rule); width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.85rem; color: var(--muted); transition: all 0.15s; }
.d-close:hover { border-color: var(--ink); color: var(--ink); }
.d-type { font-size: 0.6rem; font-weight: 700; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted); margin-bottom: 0.4rem; }
.d-amount { font-family: 'Bebas Neue', sans-serif; font-size: 3rem; line-height: 1; letter-spacing: 0.02em; margin-bottom: 0.4rem; }
.d-desc { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.2rem; }
.d-date { font-size: 0.68rem; font-weight: 500; color: var(--muted); }
.d-body { padding: 1.35rem 1.75rem; flex: 1; }
.d-field { margin-bottom: 0; padding: 1rem 0; border-bottom: 1px solid var(--rule); }
.d-field:first-child { padding-top: 0; }
.d-field:last-of-type { border-bottom: none; }
.d-field-label { font-size: 0.56rem; font-weight: 700; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted); margin-bottom: 0.3rem; }
.d-field-val { font-size: 0.88rem; font-weight: 500; line-height: 1.6; }
.d-delete { display: block; width: 100%; margin-top: 1rem; background: none; border: 2px solid var(--red); color: var(--red); font-family: 'Bebas Neue', sans-serif; font-size: 1.05rem; letter-spacing: 0.1em; padding: 0.6rem; cursor: pointer; transition: all 0.15s; }
.d-delete:hover { background: var(--red); color: white; }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast { position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%) translateY(80px); background: var(--ink); color: var(--paper); font-size: 0.76rem; font-weight: 600; padding: 0.7rem 1.4rem; border-left: 4px solid var(--gold); z-index: 999; transition: transform 0.3s cubic-bezier(0.16,1,0.3,1); white-space: nowrap; }
.toast.show { transform: translateX(-50%) translateY(0); }
.toast.success { border-left-color: var(--lime); }
.toast.expense { border-left-color: var(--red); }
.toast.error { border-left-color: var(--red); }

@keyframes rowIn { from { opacity: 0; transform: translateX(-5px); } to { opacity: 1; transform: translateX(0); } }

@media (max-width: 960px) {
  .layout { grid-template-columns: 1fr; }
  .right-col { height: auto; position: static; }
  .hero { grid-template-columns: 1fr 1fr; }
  .hero-col:nth-child(3), .hero-col:nth-child(4) { display: none; }
  .m-tag { display: none; }
}
</style>
</head>
<body>

<header class="masthead">
  <div class="m-logo">LED<span class="star">‚òÖ</span>GER</div>
  <div class="m-tag">Personal Finance</div>
  <div class="m-period">
    <button class="period-arrow" onclick="shiftPeriod(-1)">‚Äπ</button>
    <span class="period-label" id="periodLabel">‚Äî</span>
    <button class="period-arrow" onclick="shiftPeriod(1)">‚Ä∫</button>
    <div class="period-mode">
      <button class="pmode-btn active" id="btnMonth" onclick="setPeriodMode('month')">MO</button>
      <button class="pmode-btn"        id="btnYear"  onclick="setPeriodMode('year')">YR</button>
      <button class="pmode-btn"        id="btnAll"   onclick="setPeriodMode('all')">ALL</button>
    </div>
  </div>
  <div class="m-balance">
    <div class="m-balance-label">Period Net</div>
    <div class="m-balance-num" id="headerBalance">$0.00</div>
  </div>
</header>

<section class="hero">
  <div class="hero-col">
    <div class="h-label">Income</div>
    <div class="h-num income" id="heroIncome">$0</div>
    <div class="h-sub" id="incomeCount">0 entries</div>
  </div>
  <div class="hero-col">
    <div class="h-label">Expenses</div>
    <div class="h-num expense" id="heroExpense">$0</div>
    <div class="h-sub" id="expenseCount">0 entries</div>
  </div>
  <div class="hero-col">
    <div class="h-label">Net Balance</div>
    <div class="h-num net pos" id="heroNet">$0</div>
    <div class="h-sub" id="netSub">‚Äî</div>
  </div>
  <div class="hero-col">
    <div class="h-label">Budget Used</div>
    <div class="h-num budget-stat" id="heroBudget">‚Äî</div>
    <div class="h-sub" id="budgetSub">Set budgets ‚Üí</div>
  </div>
</section>

<div class="layout">
  <!-- LEFT -->
  <div class="ledger-col">
    <div class="col-header">
      <div class="col-hed">TRANSACTIONS <span class="count-pill" id="txCount">0</span></div>
      <div class="col-controls">
        <select class="ctrl-select" id="filterCat" onchange="renderTable()">
          <option value="all">All Categories</option>
          <option value="income">Income</option>
          <option value="food">Food</option>
          <option value="transport">Transport</option>
          <option value="home">Home</option>
          <option value="health">Health</option>
          <option value="leisure">Leisure</option>
          <option value="shopping">Shopping</option>
          <option value="savings">Savings</option>
          <option value="other">Other</option>
        </select>
        <select class="ctrl-select" id="sortTx" onchange="renderTable()">
          <option value="date-desc">Newest</option>
          <option value="date-asc">Oldest</option>
          <option value="amount-desc">Largest</option>
          <option value="amount-asc">Smallest</option>
        </select>
        <button class="ctrl-btn" onclick="exportCSV()">‚Üì CSV</button>
        <button class="ctrl-btn" onclick="clearPeriod()">‚úï Clear</button>
      </div>
    </div>
    <div id="tableWrap">
      <div class="empty-state show" id="emptyState">
        <div class="empty-hed">No entries this period</div>
        <div class="empty-sub">Add a transaction or change the period above</div>
      </div>
      <table class="tx-table" id="txTable" style="display:none">
        <thead><tr>
          <th>Date</th><th>Category</th><th>Description</th><th>Amount</th>
        </tr></thead>
        <tbody id="txBody"></tbody>
      </table>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="right-col">
    <div class="right-tabs">
      <button class="rtab active" onclick="switchTab('add')">+ Add</button>
      <button class="rtab"        onclick="switchTab('budget')">Budget</button>
      <button class="rtab"        onclick="switchTab('charts')">Charts</button>
    </div>

    <!-- ADD TAB -->
    <div class="tab-panel active" id="tab-add">
      <div class="tab-scroll">
        <div class="add-form">
          <div class="form-hed">ADD <span class="gold">ENTRY</span></div>
          <div class="type-toggle">
            <button class="type-btn active exp" id="btnExp" onclick="setType('expense')">‚àí Expense</button>
            <button class="type-btn inc"        id="btnInc" onclick="setType('income')">+ Income</button>
          </div>
          <div class="form-row">
            <label class="form-label">Description</label>
            <input type="text" class="form-input" id="fDesc" placeholder="e.g. Grocery run, Salary‚Ä¶" autocomplete="off">
          </div>
          <div class="amount-row">
            <div class="form-row">
              <label class="form-label">Amount ($)</label>
              <input type="number" class="form-input" id="fAmount" placeholder="0.00" min="0" step="0.01" inputmode="decimal">
            </div>
            <div class="form-row">
              <label class="form-label">Date</label>
              <input type="date" class="form-input" id="fDate">
            </div>
          </div>
          <div class="form-row">
            <label class="form-label">Category</label>
            <div class="custom-select-wrap" id="catDropWrap">
              <div class="custom-select-trigger placeholder" id="catTrigger" onclick="toggleCatDrop()">
                <span id="catTriggerText"></span>
              </div>
              <div class="custom-select-arrow"></div>
              <div class="custom-select-opts" id="catOpts">
                <div class="custom-select-opt" data-value="food"     onclick="selectCat(this)">üçΩÔ∏è Food &amp; Drink</div>
                <div class="custom-select-opt" data-value="transport" onclick="selectCat(this)">üöå Transport</div>
                <div class="custom-select-opt" data-value="home"     onclick="selectCat(this)">üè† Home &amp; Bills</div>
                <div class="custom-select-opt" data-value="health"   onclick="selectCat(this)">üíä Health</div>
                <div class="custom-select-opt" data-value="leisure"  onclick="selectCat(this)">üé≠ Leisure</div>
                <div class="custom-select-opt" data-value="shopping" onclick="selectCat(this)">üõçÔ∏è Shopping</div>
                <div class="custom-select-opt" data-value="savings"  onclick="selectCat(this)">üí∞ Savings</div>
                <div class="custom-select-opt" data-value="other"    onclick="selectCat(this)">üìÅ Other</div>
              </div>
            </div>
            <input type="hidden" id="fCat" value="">
          </div>
          <div class="form-row">
            <label class="form-label">Note (optional)</label>
            <input type="text" class="form-input" id="fNote" placeholder="Any extra detail‚Ä¶" autocomplete="off">
          </div>
          <button class="form-submit" onclick="addTransaction()">RECORD ENTRY ‚Üí</button>
        </div>
      </div>
    </div>

    <!-- BUDGET TAB -->
    <div class="tab-panel" id="tab-budget">
      <div class="tab-scroll">
        <div class="budget-panel">
          <div class="budget-intro">
            Set a <em>monthly</em> spending limit per category. The tracker compares your actual spending in the selected period against your targets ‚Äî showing exactly how over or under you are.
          </div>
          <div id="budgetRows"></div>
        </div>
      </div>
      <div class="budget-save-bar">
        <button class="budget-save-btn" onclick="saveBudgets()">SAVE BUDGETS ‚Üí</button>
      </div>
    </div>

    <!-- CHARTS TAB -->
    <div class="tab-panel" id="tab-charts">
      <div class="tab-scroll">
        <div class="charts-area">
          <div class="chart-block">
            <div class="chart-hed">Budget Health <span id="healthPct">‚Äì</span></div>
            <div class="health-meter">
              <div class="health-top">
                <div class="health-score" id="healthScore">‚Äì</div>
                <div class="health-label" id="healthLabel">Add entries<br>to see score</div>
              </div>
              <div class="health-track"><div class="health-fill" id="healthFill" style="width:0%"></div></div>
              <div class="health-tips" id="healthTip">Score appears once you have transactions.</div>
            </div>
          </div>
          <div class="chart-block">
            <div class="chart-hed">Spending by Category</div>
            <div id="catBars"><div style="font-size:0.8rem;color:var(--muted);font-style:italic">No expense data this period.</div></div>
          </div>
          <div class="chart-block">
            <div class="chart-hed">Income vs Expenses ‚Äî 6 Months</div>
            <div class="trend-chart">
              <div class="trend-bars-row" id="trendBars">
                <div class="trend-empty">No data yet</div>
              </div>
              <div class="trend-rule"></div>
              <div class="trend-legend">
                <div class="trend-legend-item"><div class="trend-legend-dot" style="background:var(--lime)"></div>Income</div>
                <div class="trend-legend-item"><div class="trend-legend-dot" style="background:var(--red)"></div>Expenses</div>
              </div>
            </div>
          </div>
          <div class="chart-block">
            <div class="chart-hed">Quick Stats</div>
            <div class="quick-grid">
              <div class="q-stat"><div class="q-stat-label">Avg Expense</div><div class="q-stat-num" id="avgExpense" style="color:var(--red)">$0</div></div>
              <div class="q-stat"><div class="q-stat-label">Avg Income</div><div class="q-stat-num" id="avgIncome" style="color:var(--lime)">$0</div></div>
              <div class="q-stat"><div class="q-stat-label">Biggest Spend</div><div class="q-stat-num" id="bigSpend">$0</div></div>
              <div class="q-stat"><div class="q-stat-label">Savings Rate</div><div class="q-stat-num" id="savingsRate" style="color:var(--green)">0%</div></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="drawer-overlay" id="drawerOverlay">
  <div class="drawer-scrim" onclick="closeDrawer()"></div>
  <div class="drawer" id="drawer"></div>
</div>
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let transactions = JSON.parse(localStorage.getItem('ledger_txs')    || '[]');
let budgets      = JSON.parse(localStorage.getItem('ledger_budgets') || '{}');
let currentType  = 'expense';
let selectedId   = null;
let periodMode   = 'month';
let periodOffset = 0;

const CAT_COLORS = {
  food:'#D4A017', transport:'#4A7DBF', home:'#B5783C',
  health:'#3DA882', income:'#4CAF50', leisure:'#A86FD4',
  shopping:'#C8321A', savings:'#3A8FBF', other:'#7A7065'
};
const CAT_ICONS = {
  food:'üçΩÔ∏è', transport:'üöå', home:'üè†', health:'üíä',
  income:'üíµ', leisure:'üé≠', shopping:'üõçÔ∏è', savings:'üí∞', other:'üìÅ'
};
const EXPENSE_CATS = ['food','transport','home','health','leisure','shopping','savings','other'];

function save() {
  localStorage.setItem('ledger_txs',     JSON.stringify(transactions));
  localStorage.setItem('ledger_budgets', JSON.stringify(budgets));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PERIOD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getPeriodBounds() {
  if (periodMode === 'all') return { start: null, end: null };
  const now = new Date();
  if (periodMode === 'month') {
    const d = new Date(now.getFullYear(), now.getMonth() + periodOffset, 1);
    const last = new Date(d.getFullYear(), d.getMonth()+1, 0);
    return {
      start: `${d.getFullYear()}-${p2(d.getMonth()+1)}-01`,
      end:   `${last.getFullYear()}-${p2(last.getMonth()+1)}-${p2(last.getDate())}`
    };
  }
  const y = now.getFullYear() + periodOffset;
  return { start:`${y}-01-01`, end:`${y}-12-31` };
}

function getPeriodLabel() {
  if (periodMode==='all') return 'ALL TIME';
  const now = new Date();
  if (periodMode==='month') {
    const d = new Date(now.getFullYear(), now.getMonth()+periodOffset, 1);
    return d.toLocaleDateString('en-US',{month:'long',year:'numeric'}).toUpperCase();
  }
  return String(now.getFullYear()+periodOffset);
}

function inPeriod(tx) {
  const {start,end} = getPeriodBounds();
  if (!start) return true;
  return tx.date >= start && tx.date <= end;
}

function getPeriodTxs() { return transactions.filter(inPeriod); }

function setPeriodMode(mode) {
  periodMode=mode; periodOffset=0;
  document.querySelectorAll('.pmode-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById({month:'btnMonth',year:'btnYear',all:'btnAll'}[mode]).classList.add('active');
  renderAll();
}

function shiftPeriod(dir) {
  if (periodMode==='all') return;
  periodOffset+=dir; renderAll();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('fDate').value = new Date().toISOString().split('T')[0];
  checkAndSeed();
  renderAll();
  renderBudgetRows();
  ['fDesc','fAmount','fNote'].forEach(id =>
    document.getElementById(id).addEventListener('keydown', e => { if(e.key==='Enter') addTransaction(); })
  );
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SEED DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SEED_VERSION = 'v10m';
function checkAndSeed() {
  if (localStorage.getItem('ledger_seed_ver') !== SEED_VERSION || !transactions.length) {
    seedSampleData();
    localStorage.setItem('ledger_seed_ver', SEED_VERSION);
  }
}

function seedSampleData() {
  const dt = (monthOff, day) => {
    const d = new Date();
    d.setDate(1);
    d.setMonth(d.getMonth() + monthOff);
    d.setDate(Math.min(day, new Date(d.getFullYear(), d.getMonth()+1, 0).getDate()));
    return d.toISOString().split('T')[0];
  };

  transactions = [
    // THIS MONTH
    { id:101, type:'income',  desc:'Monthly Salary',        cat:'income',    amount:4800,   date:dt(0,1),  note:'Direct deposit' },
    { id:102, type:'income',  desc:'Freelance ‚Äî UI Design', cat:'income',    amount:950,    date:dt(0,5),  note:'Retainer' },
    { id:103, type:'expense', desc:'Rent',                  cat:'home',      amount:1400,   date:dt(0,2),  note:'' },
    { id:104, type:'expense', desc:'Whole Foods Grocery',   cat:'food',      amount:142,    date:dt(0,4),  note:'' },
    { id:105, type:'expense', desc:'Electric & Gas Bill',   cat:'home',      amount:74,     date:dt(0,6),  note:'' },
    { id:106, type:'expense', desc:'Planet Fitness',        cat:'health',    amount:24.99,  date:dt(0,6),  note:'Monthly plan' },
    { id:107, type:'expense', desc:'Netflix',               cat:'leisure',   amount:15.99,  date:dt(0,7),  note:'' },
    { id:108, type:'expense', desc:'Lyft to Airport',       cat:'transport', amount:44,     date:dt(0,8),  note:'' },
    { id:109, type:'expense', desc:'Sushi Dinner',          cat:'food',      amount:88,     date:dt(0,9),  note:'Nobu' },
    { id:110, type:'expense', desc:'Sony Headphones',       cat:'shopping',  amount:199,    date:dt(0,10), note:'WH-1000XM5' },
    { id:111, type:'expense', desc:'Monthly Metro Pass',    cat:'transport', amount:127,    date:dt(0,11), note:'Transit' },
    { id:112, type:'expense', desc:'Emergency Savings',     cat:'savings',   amount:400,    date:dt(0,12), note:'Auto-transfer' },
    { id:113, type:'expense', desc:'Morning Coffee √ó 12',   cat:'food',      amount:62,     date:dt(0,13), note:'Daily Grounds' },
    { id:114, type:'expense', desc:'Spotify Family',        cat:'leisure',   amount:16.99,  date:dt(0,14), note:'' },
    { id:115, type:'expense', desc:'Dentist Cleaning',      cat:'health',    amount:85,     date:dt(0,15), note:'X-ray included' },
    { id:116, type:'expense', desc:'Amazon ‚Äî Books',        cat:'shopping',  amount:47,     date:dt(0,16), note:'' },
    { id:117, type:'expense', desc:'IKEA Lamp & Shelf',     cat:'home',      amount:89,     date:dt(0,17), note:'' },
    { id:118, type:'expense', desc:'Rooftop Bar Night',     cat:'leisure',   amount:90,     date:dt(0,18), note:"Friend's birthday" },
    { id:119, type:'expense', desc:'Vitamins & Supplements',cat:'health',    amount:38,     date:dt(0,19), note:'' },
    { id:120, type:'expense', desc:'Thai Takeout',          cat:'food',      amount:38,     date:dt(0,20), note:'Golden Tiger' },
    // 1 MONTH AGO
    { id:201, type:'income',  desc:'Monthly Salary',        cat:'income',    amount:4800,   date:dt(-1,1),  note:'Direct deposit' },
    { id:202, type:'income',  desc:'Stock Dividend',        cat:'income',    amount:220,    date:dt(-1,15), note:'AAPL dividend' },
    { id:203, type:'expense', desc:'Rent',                  cat:'home',      amount:1400,   date:dt(-1,2),  note:'' },
    { id:204, type:'expense', desc:'Grocery Run',           cat:'food',      amount:118,    date:dt(-1,5),  note:'' },
    { id:205, type:'expense', desc:'Electric Bill',         cat:'home',      amount:62,     date:dt(-1,8),  note:'' },
    { id:206, type:'expense', desc:'Doctor Copay',          cat:'health',    amount:30,     date:dt(-1,10), note:'' },
    { id:207, type:'expense', desc:'IMAX Movie √ó 2',        cat:'leisure',   amount:32,     date:dt(-1,12), note:'' },
    { id:208, type:'expense', desc:'Uber Pool √ó 8',         cat:'transport', amount:56,     date:dt(-1,14), note:'' },
    { id:209, type:'expense', desc:'Nike Pegasus Shoes',    cat:'shopping',  amount:145,    date:dt(-1,16), note:'Running shoes' },
    { id:210, type:'expense', desc:'Emergency Savings',     cat:'savings',   amount:400,    date:dt(-1,18), note:'' },
    { id:211, type:'expense', desc:'Coffee',                cat:'food',      amount:48,     date:dt(-1,20), note:'' },
    { id:212, type:'expense', desc:'Planet Fitness',        cat:'health',    amount:24.99,  date:dt(-1,22), note:'' },
    { id:213, type:'expense', desc:'Internet Bill',         cat:'home',      amount:65,     date:dt(-1,24), note:'Fiber 1Gbps' },
    { id:214, type:'expense', desc:'Dinner Party Host',     cat:'food',      amount:74,     date:dt(-1,26), note:'Wine & cheese' },
    // 2 MONTHS AGO
    { id:301, type:'income',  desc:'Monthly Salary',        cat:'income',    amount:4800,   date:dt(-2,1),  note:'' },
    { id:302, type:'income',  desc:'Freelance ‚Äî Logo',      cat:'income',    amount:600,    date:dt(-2,10), note:'Brand project' },
    { id:303, type:'income',  desc:'Tax Refund',            cat:'income',    amount:840,    date:dt(-2,18), note:'Federal return' },
    { id:304, type:'expense', desc:'Rent',                  cat:'home',      amount:1400,   date:dt(-2,2),  note:'' },
    { id:305, type:'expense', desc:'Grocery',               cat:'food',      amount:135,    date:dt(-2,6),  note:'' },
    { id:306, type:'expense', desc:'Flight ‚Äî NYC Round Trip',cat:'transport',amount:310,    date:dt(-2,8),  note:'JFK' },
    { id:307, type:'expense', desc:'Hotel NYC ‚Äî 2 Nights',  cat:'leisure',   amount:280,    date:dt(-2,9),  note:'Ace Hotel' },
    { id:308, type:'expense', desc:'Pharmacy',              cat:'health',    amount:22,     date:dt(-2,11), note:'' },
    { id:309, type:'expense', desc:'Emergency Savings',     cat:'savings',   amount:400,    date:dt(-2,15), note:'' },
    { id:310, type:'expense', desc:'Internet Bill',         cat:'home',      amount:65,     date:dt(-2,18), note:'' },
    { id:311, type:'expense', desc:'Clothing Haul',         cat:'shopping',  amount:230,    date:dt(-2,20), note:'Zara + COS' },
    { id:312, type:'expense', desc:'Concert Tickets √ó 2',   cat:'leisure',   amount:160,    date:dt(-2,22), note:'Floor seats' },
    { id:313, type:'expense', desc:'Coffee',                cat:'food',      amount:44,     date:dt(-2,25), note:'' },
    { id:314, type:'expense', desc:'Planet Fitness',        cat:'health',    amount:24.99,  date:dt(-2,28), note:'' },
    // 3 MONTHS AGO
    { id:401, type:'income',  desc:'Monthly Salary',        cat:'income',    amount:4800,   date:dt(-3,1),  note:'' },
    { id:402, type:'income',  desc:'Consulting Fee',        cat:'income',    amount:1200,   date:dt(-3,12), note:'Q4 strategy' },
    { id:403, type:'expense', desc:'Rent',                  cat:'home',      amount:1400,   date:dt(-3,2),  note:'' },
    { id:404, type:'expense', desc:'Grocery',               cat:'food',      amount:109,    date:dt(-3,5),  note:'' },
    { id:405, type:'expense', desc:'Heating Bill',          cat:'home',      amount:88,     date:dt(-3,8),  note:'Cold month' },
    { id:406, type:'expense', desc:'Annual Checkup',        cat:'health',    amount:60,     date:dt(-3,10), note:'' },
    { id:407, type:'expense', desc:'Holiday Dinner Out',    cat:'leisure',   amount:145,    date:dt(-3,14), note:'Family restaurant' },
    { id:408, type:'expense', desc:'Train Tickets',         cat:'transport', amount:78,     date:dt(-3,16), note:'Amtrak' },
    { id:409, type:'expense', desc:'Gift Shopping',         cat:'shopping',  amount:320,    date:dt(-3,18), note:'Christmas gifts' },
    { id:410, type:'expense', desc:'Emergency Savings',     cat:'savings',   amount:450,    date:dt(-3,20), note:'' },
    { id:411, type:'expense', desc:'Coffee & Bakeries',     cat:'food',      amount:55,     date:dt(-3,22), note:'' },
    { id:412, type:'expense', desc:'Planet Fitness',        cat:'health',    amount:24.99,  date:dt(-3,25), note:'' },
    // 4 MONTHS AGO
    { id:501, type:'income',  desc:'Monthly Salary',        cat:'income',    amount:4800,   date:dt(-4,1),  note:'' },
    { id:502, type:'income',  desc:'Side Project',          cat:'income',    amount:450,    date:dt(-4,8),  note:'App dev' },
    { id:503, type:'expense', desc:'Rent',                  cat:'home',      amount:1400,   date:dt(-4,2),  note:'' },
    { id:504, type:'expense', desc:"Trader Joe's",          cat:'food',      amount:96,     date:dt(-4,6),  note:'' },
    { id:505, type:'expense', desc:'Internet & Phone',      cat:'home',      amount:120,    date:dt(-4,8),  note:'Bundle plan' },
    { id:506, type:'expense', desc:'Eye Exam',              cat:'health',    amount:40,     date:dt(-4,10), note:'' },
    { id:507, type:'expense', desc:'Weekend Getaway',       cat:'leisure',   amount:390,    date:dt(-4,13), note:'Catskills Airbnb' },
    { id:508, type:'expense', desc:'Car Rental',            cat:'transport', amount:95,     date:dt(-4,14), note:'Weekend trip' },
    { id:509, type:'expense', desc:'New Work Shoes',        cat:'shopping',  amount:175,    date:dt(-4,16), note:'Oxford brogues' },
    { id:510, type:'expense', desc:'Emergency Savings',     cat:'savings',   amount:400,    date:dt(-4,18), note:'' },
    { id:511, type:'expense', desc:'Restaurants',           cat:'food',      amount:128,    date:dt(-4,22), note:'' },
    { id:512, type:'expense', desc:'Planet Fitness',        cat:'health',    amount:24.99,  date:dt(-4,25), note:'' },
    // 5 MONTHS AGO
    { id:601, type:'income',  desc:'Monthly Salary',        cat:'income',    amount:4600,   date:dt(-5,1),  note:'Pre-raise' },
    { id:602, type:'income',  desc:'Referral Bonus',        cat:'income',    amount:300,    date:dt(-5,20), note:'' },
    { id:603, type:'expense', desc:'Rent',                  cat:'home',      amount:1400,   date:dt(-5,2),  note:'' },
    { id:604, type:'expense', desc:'Grocery',               cat:'food',      amount:112,    date:dt(-5,5),  note:'' },
    { id:605, type:'expense', desc:'Electric Bill',         cat:'home',      amount:58,     date:dt(-5,8),  note:'' },
    { id:606, type:'expense', desc:'Gym Membership',        cat:'health',    amount:24.99,  date:dt(-5,10), note:'' },
    { id:607, type:'expense', desc:'Spotify',               cat:'leisure',   amount:9.99,   date:dt(-5,12), note:'' },
    { id:608, type:'expense', desc:'Metro Monthly',         cat:'transport', amount:127,    date:dt(-5,14), note:'' },
    { id:609, type:'expense', desc:'Amazon Misc',           cat:'shopping',  amount:68,     date:dt(-5,16), note:'' },
    { id:610, type:'expense', desc:'Emergency Savings',     cat:'savings',   amount:350,    date:dt(-5,18), note:'' },
    { id:611, type:'expense', desc:'Coffee',                cat:'food',      amount:40,     date:dt(-5,22), note:'' },
    { id:612, type:'expense', desc:'Pharmacy',              cat:'health',    amount:18,     date:dt(-5,25), note:'' },
  ];
  budgets = { food:320, transport:200, home:1600, health:130, leisure:250, shopping:200, savings:450, other:80 };
  save();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CUSTOM CATEGORY DROPDOWN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let selectedCatValue = '';

function toggleCatDrop() {
  const opts = document.getElementById('catOpts');
  const trigger = document.getElementById('catTrigger');
  const isOpen = opts.classList.contains('open');
  opts.classList.toggle('open', !isOpen);
  trigger.classList.toggle('open', !isOpen);
}

function selectCat(el) {
  selectedCatValue = el.dataset.value;
  document.getElementById('fCat').value = selectedCatValue;
  document.getElementById('catTriggerText').textContent = el.textContent;
  document.getElementById('catTrigger').classList.remove('placeholder', 'open');
  document.getElementById('catOpts').classList.remove('open');
  document.querySelectorAll('.custom-select-opt').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
}

function resetCatDrop() {
  selectedCatValue = '';
  document.getElementById('fCat').value = '';
  document.getElementById('catTriggerText').textContent = '';
  document.getElementById('catTrigger').classList.add('placeholder');
  document.getElementById('catTrigger').classList.remove('open');
  document.getElementById('catOpts').classList.remove('open');
  document.querySelectorAll('.custom-select-opt').forEach(o => o.classList.remove('selected'));
}

// Close dropdown when clicking outside
document.addEventListener('click', e => {
  const wrap = document.getElementById('catDropWrap');
  if (wrap && !wrap.contains(e.target)) {
    document.getElementById('catOpts').classList.remove('open');
    document.getElementById('catTrigger').classList.remove('open');
  }
});
function setType(t) {
  currentType = t;
  document.getElementById('btnExp').classList.toggle('active', t==='expense');
  document.getElementById('btnInc').classList.toggle('active', t==='income');
}

function addTransaction() {
  const desc   = document.getElementById('fDesc').value.trim();
  const amount = parseFloat(document.getElementById('fAmount').value);
  const date   = document.getElementById('fDate').value;
  const cat    = document.getElementById('fCat').value;
  const note   = document.getElementById('fNote').value.trim();
  if (!desc)           { showToast('Enter a description','error'); return; }
  if (!amount||amount<=0){ showToast('Enter a Valid Amount','error'); return; }
  if (!date)           { showToast('Select a Date','error'); return; }
  if (!cat)            { showToast('Select a Category','error'); return; }
  transactions.unshift({ id:Date.now(), type:currentType, desc, amount, date, cat, note });
  save();
  document.getElementById('fDesc').value='';
  document.getElementById('fAmount').value='';
  document.getElementById('fNote').value='';
  resetCatDrop();
  renderAll();
  showToast(currentType==='income'?'+ Income Recorded':'‚àí Expense Recorded', currentType==='income'?'success':'expense');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER ALL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAll() {
  document.getElementById('periodLabel').textContent = getPeriodLabel();
  renderTable();
  renderStats();
  renderCatBars();
  renderTrend();
  renderHealthScore();
  renderQuickStats();
  renderBudgetRows();
}

function getFiltered() {
  const catF = document.getElementById('filterCat').value;
  const sort  = document.getElementById('sortTx').value;
  let list = getPeriodTxs();
  if (catF!=='all') list = list.filter(t=>t.cat===catF||(catF==='income'&&t.type==='income'));
  list.sort((a,b)=>{
    if (sort==='date-desc')   return b.date.localeCompare(a.date);
    if (sort==='date-asc')    return a.date.localeCompare(b.date);
    if (sort==='amount-desc') return b.amount-a.amount;
    if (sort==='amount-asc')  return a.amount-b.amount;
    return 0;
  });
  return list;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER TABLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderTable() {
  const list  = getFiltered();
  const empty = document.getElementById('emptyState');
  const table = document.getElementById('txTable');
  const body  = document.getElementById('txBody');
  document.getElementById('txCount').textContent = list.length;

  if (!list.length) { empty.classList.add('show'); table.style.display='none'; return; }
  empty.classList.remove('show'); table.style.display='table'; body.innerHTML='';

  list.forEach((tx,i) => {
    const isInc = tx.type==='income';
    const d = new Date(tx.date+'T12:00:00');
    const dateStr = d.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'2-digit'});
    const tr = document.createElement('tr');
    tr.className = 'tx-row' + (tx.id===selectedId?' selected':'');
    tr.style.animationDelay = `${Math.min(i*0.02,0.4)}s`;
    tr.onclick = () => openDrawer(tx);
    const emoji = CAT_ICONS[tx.cat] || '‚òÖ';
    const catLabel = tx.cat || '';
    tr.innerHTML = `
      <td><span class="tx-date">${dateStr}</span></td>
      <td><span class="tx-cat cat-${tx.cat||'other'}"><span class="tx-cat-icon">${emoji}</span>${catLabel}</span></td>
      <td>
        <div class="tx-desc">${tx.desc}</div>
        ${tx.note?`<div class="tx-note">${tx.note}</div>`:''}
      </td>
      <td><span class="tx-amount ${isInc?'inc':'exp'}">${isInc?'+':'‚àí'}$${tx.amount.toFixed(2)}</span></td>
    `;
    body.appendChild(tr);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER STATS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderStats() {
  const period  = getPeriodTxs();
  const income  = period.filter(t=>t.type==='income').reduce((s,t)=>s+t.amount,0);
  const expense = period.filter(t=>t.type!=='income').reduce((s,t)=>s+t.amount,0);
  const net = income-expense;
  const scale = periodMode==='year'?12:1;
  const totalBudget = EXPENSE_CATS.reduce((s,c)=>s+(parseFloat(budgets[c])||0)*scale,0);
  const usedPct = totalBudget>0 ? Math.min(expense/totalBudget*100,150):0;
  const budgetDiff = totalBudget>0 ? expense-totalBudget : null;

  document.getElementById('heroIncome').textContent  = '$'+fmt(income);
  document.getElementById('heroExpense').textContent = '$'+fmt(expense);
  document.getElementById('heroNet').textContent     = (net<0?'‚àí':'')+'$'+fmt(Math.abs(net));
  document.getElementById('heroNet').className       = 'h-num net '+(net>=0?'pos':'neg');
  document.getElementById('incomeCount').textContent = period.filter(t=>t.type==='income').length+' entries';
  document.getElementById('expenseCount').textContent= period.filter(t=>t.type!=='income').length+' entries';

  const nsEl=document.getElementById('netSub');
  nsEl.textContent=net>=0?'‚ñ≤ Surplus':'‚ñº Deficit';
  nsEl.className='h-sub '+(net>=0?'under':'over');

  const hb=document.getElementById('headerBalance');
  hb.textContent=(net<0?'‚àí':'')+'$'+fmtFull(Math.abs(net));
  hb.className='m-balance-num'+(net<0?' neg':'');

  if (totalBudget>0) {
    document.getElementById('heroBudget').textContent=Math.round(usedPct)+'%';
    const bs=document.getElementById('budgetSub');
    if (budgetDiff!==null) {
      if (budgetDiff>0) { bs.textContent='$'+fmt(budgetDiff)+' over'; bs.className='h-sub over'; }
      else              { bs.textContent='$'+fmt(-budgetDiff)+' under'; bs.className='h-sub under'; }
    }
  } else {
    document.getElementById('heroBudget').textContent='‚Äî';
    document.getElementById('budgetSub').textContent='Set budgets ‚Üí';
    document.getElementById('budgetSub').className='h-sub';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BUDGET ROWS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderBudgetRows() {
  const container=document.getElementById('budgetRows');
  if (!container) return;
  const period=getPeriodTxs();
  const actuals={};
  period.filter(t=>t.type!=='income').forEach(t=>{ actuals[t.cat]=(actuals[t.cat]||0)+t.amount; });
  const scale=periodMode==='year'?12:1;

  container.innerHTML=EXPENSE_CATS.map(cat=>{
    const mb=parseFloat(budgets[cat])||0;
    const pb=mb*scale;
    const actual=actuals[cat]||0;
    const diff=actual-pb;
    const pct=pb>0?Math.min(actual/pb*100,100):0;
    const isOver=pb>0&&actual>pb;
    const noBudget=pb<=0;
    const fillColor=noBudget?(CAT_COLORS[cat]||'#888'):isOver?'var(--red)':'var(--green)';
    const sCls=noBudget?'none':isOver?'over':'under';

    let sNum,sLabel;
    if (noBudget) {
      sNum=actual>0?'$'+fmt(actual):'‚Äî';
      sLabel=actual>0?'SPENT':'NO LIMIT';
    } else if (isOver) {
      sNum='+$'+fmt(diff); sLabel='OVER';
    } else {
      sNum='$'+fmt(-diff); sLabel='LEFT';
    }

    const pLabel=periodMode==='year'?'annual':'monthly';

    return `<div class="budget-row">
      <div class="budget-row-top">
        <div class="budget-cat">
          <span class="budget-cat-star">${CAT_ICONS[cat]||'‚òÖ'}</span>
          <span class="budget-cat-name">${cat}</span>
        </div>
        <div class="budget-input-wrap">
          <span>$</span>
          <input type="number" class="budget-input" data-cat="${cat}" value="${mb||''}" placeholder="‚Äî" min="0" step="1" inputmode="numeric">
        </div>
        <div class="budget-status">
          <span class="budget-status-num ${sCls}">${sNum}</span>
          <span class="budget-status-label ${sCls}">${sLabel}</span>
        </div>
      </div>
      ${pb>0?`<div class="budget-bar-wrap">
        <div class="budget-track"><div class="budget-fill" style="background:${fillColor}" data-pct="${Math.min(pct,100).toFixed(1)}"></div></div>
        <div class="budget-bar-meta">
          <span>$${fmt(actual)} spent</span>
          <span>/ $${fmt(pb)} ${pLabel}</span>
        </div>
      </div>`:''}
    </div>`;
  }).join('');

  setTimeout(()=>{
    container.querySelectorAll('.budget-fill').forEach(el=>{
      el.style.transition='width 0.7s cubic-bezier(0.16,1,0.3,1)';
      el.style.width=el.dataset.pct+'%';
    });
  },80);
}

function saveBudgets() {
  document.querySelectorAll('.budget-input').forEach(inp=>{
    budgets[inp.dataset.cat]=parseFloat(inp.value)||0;
  });
  save(); renderAll();
  showToast('Budgets saved ‚úì','success');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CATEGORY BARS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderCatBars() {
  const period=getPeriodTxs();
  const totals={};
  period.filter(t=>t.type!=='income').forEach(t=>{ totals[t.cat]=(totals[t.cat]||0)+t.amount; });
  const sorted=Object.entries(totals).sort((a,b)=>b[1]-a[1]);
  const maxAmt=sorted[0]?.[1]||1;
  const scale=periodMode==='year'?12:1;
  const container=document.getElementById('catBars');
  if (!sorted.length) { container.innerHTML='<div style="font-size:0.8rem;color:var(--muted);font-style:italic">No expense data this period.</div>'; return; }
  container.innerHTML=sorted.map(([cat,amt])=>{
    const b=(parseFloat(budgets[cat])||0)*scale;
    const over=b>0&&amt>b;
    return `<div class="cat-bar-row">
      <div class="cat-bar-label" style="color:${CAT_COLORS[cat]}">${cat}</div>
      <div class="cat-bar-track"><div class="cat-bar-fill" data-pct="${(amt/maxAmt*100).toFixed(1)}" style="width:0%;background:${over?'var(--red)':CAT_COLORS[cat]}"></div></div>
      <div class="cat-bar-right">$${fmt(amt)}${b>0?`<br><span style="color:${over?'var(--red)':'var(--muted)'};font-size:0.54rem">/ $${fmt(b)}</span>`:''}</div>
    </div>`;
  }).join('');
  setTimeout(()=>{ container.querySelectorAll('.cat-bar-fill').forEach(el=>{ el.style.transition='width 0.8s cubic-bezier(0.16,1,0.3,1)'; el.style.width=el.dataset.pct+'%'; }); },100);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TREND CHART (from ledger 9 ‚Äî bar chart style)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderTrend() {
  const months = [];
  for (let i=5; i>=0; i--) {
    const d = new Date(); d.setMonth(d.getMonth()-i);
    months.push({
      key: `${d.getFullYear()}-${p2(d.getMonth()+1)}`,
      label: d.toLocaleDateString('en-US',{month:'short'}),
      inc: 0, exp: 0
    });
  }
  transactions.forEach(t=>{
    const mo=months.find(m=>m.key===t.date.substring(0,7));
    if (!mo) return;
    if (t.type==='income') mo.inc+=t.amount; else mo.exp+=t.amount;
  });
  const maxVal = Math.max(...months.map(m=>Math.max(m.inc,m.exp)), 1);
  const hasAny = months.some(m=>m.inc>0||m.exp>0);
  const container = document.getElementById('trendBars');
  if (!hasAny) { container.innerHTML='<div class="trend-empty">No data in last 6 months</div>'; return; }
  const H = 72;
  container.innerHTML = months.map(m=>{
    const iH = m.inc>0 ? Math.max(Math.round(m.inc/maxVal*H), 3) : 0;
    const eH = m.exp>0 ? Math.max(Math.round(m.exp/maxVal*H), 3) : 0;
    return `<div class="trend-month">
      <div class="trend-pair">
        <div class="trend-bar inc" style="height:${iH}px" title="${m.label} Income: $${fmt(m.inc)}"></div>
        <div class="trend-bar exp" style="height:${eH}px" title="${m.label} Expenses: $${fmt(m.exp)}"></div>
      </div>
      <div class="trend-lbl">${m.label}</div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HEALTH SCORE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderHealthScore() {
  const period=getPeriodTxs();
  if (!period.length) return;
  const income=period.filter(t=>t.type==='income').reduce((s,t)=>s+t.amount,0);
  const expense=period.filter(t=>t.type!=='income').reduce((s,t)=>s+t.amount,0);
  const savings=period.filter(t=>t.cat==='savings').reduce((s,t)=>s+t.amount,0);
  const scale=periodMode==='year'?12:1;
  const totalBudget=EXPENSE_CATS.reduce((s,c)=>s+(parseFloat(budgets[c])||0)*scale,0);
  let score=income>0?(expense/income<0.5?88:expense/income<0.7?74:expense/income<0.9?60:expense/income<1?44:24):50;
  if (savings>0) score=Math.min(score+8,99);
  if (totalBudget>0) { if(expense/totalBudget<0.8) score=Math.min(score+8,99); else if(expense/totalBudget>1.2) score=Math.max(score-10,10); }
  const label=score>=80?'EXCELLENT':score>=65?'GOOD':score>=45?'FAIR':'AT RISK';
  const cls=score>=65?'':score>=45?'warn':'danger';
  const tips={'':'Great discipline. Keep building your savings buffer.',warn:'Expenses close to income. Look for cuts.',danger:'Spending exceeds income. Review recurring expenses.'}[cls];
  document.getElementById('healthScore').textContent=score;
  document.getElementById('healthScore').className='health-score '+cls;
  document.getElementById('healthLabel').innerHTML=`${label}<br>Financial Health`;
  document.getElementById('healthPct').textContent=score+'/99';
  document.getElementById('healthTip').textContent=tips;
  const fill=document.getElementById('healthFill');
  fill.className='health-fill '+cls;
  setTimeout(()=>{ fill.style.width=score+'%'; },100);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// QUICK STATS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderQuickStats() {
  const period=getPeriodTxs();
  const exp=period.filter(t=>t.type!=='income');
  const inc=period.filter(t=>t.type==='income');
  const income=inc.reduce((s,t)=>s+t.amount,0);
  const expense=exp.reduce((s,t)=>s+t.amount,0);
  document.getElementById('avgExpense').textContent='$'+fmt(exp.length?expense/exp.length:0);
  document.getElementById('avgIncome').textContent ='$'+fmt(inc.length?income/inc.length:0);
  document.getElementById('bigSpend').textContent  ='$'+fmt(exp.length?Math.max(...exp.map(t=>t.amount)):0);
  document.getElementById('savingsRate').textContent=(income>0?Math.max(0,(income-expense)/income*100):0).toFixed(0)+'%';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DETAIL DRAWER (from ledger 10)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openDrawer(tx) {
  selectedId=tx.id; renderTable();
  const isInc=tx.type==='income';
  const d=new Date(tx.date+'T12:00:00');
  const dateStr=d.toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
  const amtColor=isInc?'var(--lime)':'var(--red)';
  const emoji=CAT_ICONS[tx.cat]||'‚òÖ';
  const scale=periodMode==='year'?12:1;
  const catBudget=(parseFloat(budgets[tx.cat])||0)*scale;
  const catActual=getPeriodTxs().filter(t=>t.cat===tx.cat&&t.type!=='income').reduce((s,t)=>s+t.amount,0);
  const budgetLine=catBudget>0&&!isInc?`
    <div class="d-field">
      <div class="d-field-label">${tx.cat.charAt(0).toUpperCase()+tx.cat.slice(1)} Budget</div>
      <div class="d-field-val">$${fmt(catActual)} of $${fmt(catBudget)} &mdash; <span style="color:${catActual>catBudget?'var(--red)':'var(--green)'}">${catActual>catBudget?'$'+fmt(catActual-catBudget)+' over budget':'$'+fmt(catBudget-catActual)+' remaining'}</span></div>
    </div>`:'';
  document.getElementById('drawer').innerHTML=`
    <div class="d-top">
      <button class="d-close" onclick="closeDrawer()">‚úï</button>
      <div class="d-type">${emoji} ${tx.cat.toUpperCase()} ¬∑ ${tx.type.toUpperCase()}</div>
      <div class="d-amount" style="color:${amtColor}">${isInc?'+':'‚àí'}$${fmtFull(tx.amount)}</div>
      <div class="d-desc">${tx.desc}</div>
      <div class="d-date">${dateStr}</div>
    </div>
    <div class="d-body">
      <div class="d-field">
        <div class="d-field-label">Type</div>
        <div class="d-field-val">${isInc?'+ Income':'‚àí Expense'}</div>
      </div>
      <div class="d-field">
        <div class="d-field-label">Category</div>
        <div class="d-field-val"><span class="tx-cat cat-${tx.cat}"><span class="tx-cat-icon">${emoji}</span>${tx.cat}</span></div>
      </div>
      ${tx.note?`
      <div class="d-field">
        <div class="d-field-label">Note</div>
        <div class="d-field-val" style="font-style:italic;color:var(--muted)">${tx.note}</div>
      </div>`:''}
      ${budgetLine}
      <div class="d-field">
        <div class="d-field-label">% of Period ${isInc?'Income':'Expenses'}</div>
        <div class="d-field-val">${getPct(tx)}%</div>
      </div>
      <button class="d-delete" onclick="deleteTransaction(${tx.id})">‚úï DELETE THIS ENTRY</button>
    </div>`;
  document.getElementById('drawerOverlay').classList.add('open');
}

function closeDrawer() {
  document.getElementById('drawerOverlay').classList.remove('open');
  selectedId=null;
  document.querySelectorAll('.tx-row.selected').forEach(r=>r.classList.remove('selected'));
}

function deleteTransaction(id) {
  transactions=transactions.filter(t=>t.id!==id);
  save(); closeDrawer(); renderAll();
  showToast('Entry Deleted');
}

function getPct(tx) {
  const isInc=tx.type==='income';
  const period=getPeriodTxs();
  const total=period.filter(t=>isInc?t.type==='income':t.type!=='income').reduce((s,t)=>s+t.amount,0);
  return total?(tx.amount/total*100).toFixed(1):'0.0';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TABS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchTab(tab) {
  const tabs=['add','budget','charts'];
  document.querySelectorAll('.rtab').forEach((b,i)=>b.classList.toggle('active',tabs[i]===tab));
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  document.getElementById('tab-'+tab).classList.add('active');
  if (tab==='charts') renderTrend();
  if (tab==='budget') renderBudgetRows();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLEAR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function clearPeriod() {
  const label = getPeriodLabel();
  const what = periodMode==='all' ? 'ALL transactions' : `all transactions in ${label}`;
  if (!confirm(`Clear ${what}? This cannot be undone.`)) return;
  if (periodMode==='all') {
    transactions=[];
  } else {
    const {start,end}=getPeriodBounds();
    transactions=transactions.filter(t=>t.date<start||t.date>end);
  }
  save(); renderAll();
  showToast(`Cleared ${label}`,'success');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILITIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function fmt(n) { return Math.round(n).toLocaleString('en-US'); }
function fmtFull(n) { return n.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}); }
function p2(n) { return String(n).padStart(2,'0'); }

function exportCSV() {
  if (!transactions.length) { showToast('No data','error'); return; }
  const csv=['Date,Type,Category,Description,Note,Amount',...transactions.map(t=>`${t.date},${t.type},${t.cat},"${t.desc}","${t.note||''}",${t.type==='income'?t.amount:-t.amount}`)].join('\n');
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
  a.download=`ledger-${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  showToast('CSV exported ‚úì','success');
}

function showToast(msg,type='') {
  const t=document.getElementById('toast');
  t.textContent=msg; t.className='toast show '+type;
  clearTimeout(t._timer); t._timer=setTimeout(()=>t.className='toast',3000);
}
</script>
</body>
</html>
