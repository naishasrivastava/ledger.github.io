<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LEDGER - Personal Finance Tracker</title>
<link rel="icon" type="image/png" href="favicon(1).png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=IBM+Plex+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --ink:     #0D0D0D;
  --paper:   #F2EDE4;
  --off:     #FAF7F2;
  --rule:    #D4C9BC;
  --muted:   #7A7065;
  --red:     #C8321A;
  --green:   #1E4D2B;
  --lime:    #A8C84A;
  --gold:    #D4A017;
  --blue:    #1A3A6B;
  --mid:     #EDE8DF;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  font-family: 'Libre Baskerville', Georgia, serif;
  background: var(--paper);
  color: var(--ink);
  min-height: 100vh;
}

/* ‚îÄ‚îÄ MASTHEAD ‚îÄ‚îÄ */
.masthead {
  background: var(--ink);
  border-bottom: 4px solid var(--gold);
  display: flex;
  align-items: stretch;
  position: sticky;
  top: 0;
  z-index: 200;
}

.m-logo {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 2.4rem;
  color: var(--paper);
  padding: 0.55rem 2rem;
  border-right: 2px solid #1a1a1a;
  letter-spacing: 0.08em;
  line-height: 1;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.m-logo .dot { color: var(--gold); }

.m-tag {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.58rem;
  letter-spacing: 0.22em;
  text-transform: uppercase;
  color: var(--muted);
  padding: 0 1.5rem;
  display: flex;
  align-items: center;
  border-right: 1px solid #1a1a1a;
}

.m-date {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.6rem;
  color: var(--muted);
  padding: 0 1.5rem;
  display: flex;
  align-items: center;
  letter-spacing: 0.1em;
}

.m-balance {
  margin-left: auto;
  display: flex;
  align-items: center;
  border-left: 2px solid #1a1a1a;
  padding: 0 2rem;
  gap: 1rem;
}

.m-balance-label {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.58rem;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: var(--muted);
}

.m-balance-num {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.8rem;
  letter-spacing: 0.04em;
  color: var(--lime);
  line-height: 1;
  transition: color 0.3s;
}
.m-balance-num.neg { color: var(--red); }

/* ‚îÄ‚îÄ HERO BAND ‚îÄ‚îÄ */
.hero {
  background: var(--ink);
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  border-bottom: 3px solid #1a1a1a;
}

.hero-col {
  padding: 2.5rem 2.5rem;
  border-right: 1px solid #1e1e1e;
  position: relative;
  overflow: hidden;
}
.hero-col:last-child { border-right: none; }

.h-label {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.58rem;
  letter-spacing: 0.25em;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 0.5rem;
}

.h-num {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 4rem;
  line-height: 1;
  letter-spacing: 0.02em;
  transition: all 0.4s ease;
}
.h-num.income { color: var(--lime); }
.h-num.expense { color: var(--red); }
.h-num.net.pos { color: var(--paper); }
.h-num.net.neg { color: var(--red); }

.h-sub {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.62rem;
  color: #444;
  letter-spacing: 0.08em;
  margin-top: 0.4rem;
}

.h-bar {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 4px;
  background: #1a1a1a;
}
.h-bar-fill {
  height: 100%;
  transition: width 0.8s cubic-bezier(0.16,1,0.3,1);
}
.income .h-bar-fill { background: var(--lime); }
.expense .h-bar-fill { background: var(--red); }
.net .h-bar-fill { background: var(--gold); }

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.layout {
  display: grid;
  grid-template-columns: 1fr 380px;
  min-height: calc(100vh - 130px);
}

/* ‚îÄ‚îÄ LEFT: LEDGER TABLE ‚îÄ‚îÄ */
.ledger-col {
  border-right: 2px solid var(--ink);
}

.col-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 2rem;
  border-bottom: 3px solid var(--ink);
  background: var(--paper);
  position: sticky;
  top: 62px;
  z-index: 100;
}

.col-hed {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.6rem;
  letter-spacing: 0.06em;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.count-pill {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.62rem;
  background: var(--ink);
  color: var(--paper);
  padding: 0.2rem 0.6rem;
  letter-spacing: 0.08em;
}

.col-controls {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.ctrl-select {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.65rem;
  letter-spacing: 0.08em;
  background: none;
  border: 1px solid var(--rule);
  color: var(--muted);
  padding: 0.35rem 0.7rem;
  cursor: pointer;
  outline: none;
  appearance: none;
}

.ctrl-btn {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.65rem;
  letter-spacing: 0.08em;
  background: none;
  border: 1px solid var(--rule);
  color: var(--muted);
  padding: 0.35rem 0.7rem;
  cursor: pointer;
  transition: all 0.15s;
}
.ctrl-btn:hover { border-color: var(--ink); color: var(--ink); }
.ctrl-btn.active { background: var(--ink); color: var(--paper); border-color: var(--ink); }

/* ‚îÄ‚îÄ TRANSACTION TABLE ‚îÄ‚îÄ */
.tx-table {
  width: 100%;
  border-collapse: collapse;
}

.tx-table thead th {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.58rem;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: var(--muted);
  padding: 0.6rem 1rem;
  text-align: left;
  border-bottom: 1px solid var(--rule);
  background: var(--off);
  font-weight: 400;
  position: sticky;
  top: 110px;
  z-index: 99;
}

.tx-table thead th:last-child { text-align: right; padding-right: 2rem; }
.tx-table thead th:first-child { padding-left: 2rem; }

.tx-row {
  border-bottom: 1px solid var(--rule);
  cursor: pointer;
  transition: background 0.12s;
  animation: rowIn 0.3s ease both;
}
.tx-row:hover { background: var(--mid); }
.tx-row.selected { background: var(--ink); color: var(--paper); }

.tx-row td {
  padding: 0.85rem 1rem;
  vertical-align: middle;
}
.tx-row td:first-child { padding-left: 2rem; }
.tx-row td:last-child { padding-right: 2rem; text-align: right; }

.tx-date {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.68rem;
  color: var(--muted);
  white-space: nowrap;
}
.tx-row.selected .tx-date { color: #888; }

.tx-cat {
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.58rem;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  padding: 0.18rem 0.55rem;
  border: 1px solid currentColor;
}

.tx-desc {
  font-size: 0.9rem;
  font-weight: 700;
  line-height: 1.2;
}
.tx-note {
  font-size: 0.72rem;
  color: var(--muted);
  font-style: italic;
  margin-top: 2px;
}
.tx-row.selected .tx-note { color: #888; }

.tx-amount {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.3rem;
  letter-spacing: 0.03em;
  white-space: nowrap;
}
.tx-amount.inc { color: var(--lime); }
.tx-amount.exp { color: var(--red); }
.tx-row.selected .tx-amount.inc { color: var(--lime); }
.tx-row.selected .tx-amount.exp { color: #ff7766; }

/* category colors */
.cat-food { color: var(--gold); border-color: var(--gold); background: rgba(212,160,23,0.08); }
.cat-transport { color: var(--blue); border-color: var(--blue); background: rgba(26,58,107,0.08); }
.cat-home { color: #8B5E3C; border-color: #8B5E3C; background: rgba(139,94,60,0.08); }
.cat-health { color: #2D7A6A; border-color: #2D7A6A; background: rgba(45,122,106,0.08); }
.cat-income { color: var(--green); border-color: var(--green); background: rgba(30,77,43,0.08); }
.cat-leisure { color: #7B3FB0; border-color: #7B3FB0; background: rgba(123,63,176,0.08); }
.cat-shopping { color: #C8321A; border-color: #C8321A; background: rgba(200,50,26,0.08); }
.cat-savings { color: #1A5C8A; border-color: #1A5C8A; background: rgba(26,92,138,0.08); }
.cat-other { color: var(--muted); border-color: var(--muted); background: rgba(122,112,101,0.08); }

.tx-row.selected .tx-cat {
  background: rgba(255,255,255,0.1) !important;
  border-color: rgba(255,255,255,0.3) !important;
  color: rgba(255,255,255,0.8) !important;
}

.empty-state {
  padding: 4rem 2rem;
  text-align: center;
  display: none;
}
.empty-state.show { display: block; }
.empty-hed { font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; letter-spacing: 0.05em; margin-bottom: 0.5rem; }
.empty-sub { font-size: 0.85rem; color: var(--muted); font-style: italic; }

/* ‚îÄ‚îÄ RIGHT PANEL ‚îÄ‚îÄ */
.right-col {
  background: var(--off);
  display: flex;
  flex-direction: column;
}

/* ADD FORM */
.add-form {
  background: var(--ink);
  padding: 1.5rem 1.5rem 1.25rem;
  border-bottom: 3px solid var(--gold);
}

.form-hed {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.5rem;
  color: var(--paper);
  letter-spacing: 0.08em;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.form-hed .gold { color: var(--gold); }

.type-toggle {
  display: flex;
  gap: 0;
  margin-bottom: 1rem;
  border: 1px solid #333;
}

.type-btn {
  flex: 1;
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.65rem;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  padding: 0.6rem;
  background: none;
  border: none;
  color: #555;
  cursor: pointer;
  transition: all 0.15s;
}
.type-btn.active.exp { background: var(--red); color: white; }
.type-btn.active.inc { background: var(--lime); color: var(--ink); }

.form-row { margin-bottom: 0.65rem; }

.form-label {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.55rem;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: #555;
  display: block;
  margin-bottom: 0.3rem;
}

.form-input, .form-select {
  width: 100%;
  background: #1a1a1a;
  border: 1px solid #333;
  color: var(--paper);
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.82rem;
  padding: 0.65rem 0.9rem;
  outline: none;
  transition: border-color 0.15s;
  appearance: none;
}
.form-input:focus, .form-select:focus { border-color: var(--gold); }
.form-input::placeholder { color: #444; }

.form-select option { background: #1a1a1a; }

.amount-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.65rem;
}

.form-submit {
  width: 100%;
  margin-top: 0.75rem;
  background: var(--gold);
  border: none;
  color: var(--ink);
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.2rem;
  letter-spacing: 0.12em;
  padding: 0.75rem;
  cursor: pointer;
  transition: all 0.15s;
}
.form-submit:hover { background: var(--paper); }

/* ‚îÄ‚îÄ CHARTS SECTION ‚îÄ‚îÄ */
.charts-area {
  flex: 1;
  padding: 1.25rem 1.5rem;
  overflow-y: auto;
}

.charts-area::-webkit-scrollbar { width: 3px; }
.charts-area::-webkit-scrollbar-thumb { background: var(--rule); }

.chart-block {
  margin-bottom: 1.75rem;
}

.chart-hed {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.6rem;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--muted);
  border-bottom: 1px solid var(--rule);
  padding-bottom: 0.5rem;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/* Spending by category bars */
.cat-bar-row {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.65rem;
}

.cat-bar-label {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.62rem;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: var(--ink);
  width: 80px;
  flex-shrink: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.cat-bar-track {
  flex: 1;
  height: 10px;
  background: var(--rule);
  position: relative;
}

.cat-bar-fill {
  height: 100%;
  transition: width 0.8s cubic-bezier(0.16,1,0.3,1);
  position: relative;
}

.cat-bar-fill::after {
  content: '';
  position: absolute;
  right: 0; top: 0; bottom: 0;
  width: 2px;
  background: rgba(255,255,255,0.4);
}

.cat-bar-amt {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.62rem;
  color: var(--muted);
  width: 70px;
  text-align: right;
  flex-shrink: 0;
}

/* Monthly trend sparkline */
.sparkline-wrap {
  height: 80px;
  position: relative;
  background: var(--mid);
  overflow: hidden;
}

canvas.sparkline {
  width: 100%;
  height: 100%;
  display: block;
}

/* Budget health meter */
.health-meter {
  background: var(--mid);
  border: 2px solid var(--ink);
  padding: 1rem;
}

.health-top {
  display: flex;
  justify-content: space-between;
  align-items: flex-end;
  margin-bottom: 0.75rem;
}

.health-score {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 3.5rem;
  color: var(--green);
  line-height: 1;
  transition: color 0.4s;
}
.health-score.warn { color: var(--gold); }
.health-score.danger { color: var(--red); }

.health-label {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.58rem;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--muted);
  text-align: right;
  line-height: 1.5;
}

.health-track {
  height: 8px;
  background: var(--rule);
  margin-bottom: 0.75rem;
}
.health-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--green), var(--lime));
  transition: width 0.8s cubic-bezier(0.16,1,0.3,1), background 0.4s;
}
.health-fill.warn { background: linear-gradient(90deg, var(--gold), #f0c040); }
.health-fill.danger { background: linear-gradient(90deg, var(--red), #e05040); }

.health-tips {
  font-size: 0.75rem;
  color: var(--muted);
  font-style: italic;
  line-height: 1.5;
}

/* ‚îÄ‚îÄ DETAIL DRAWER ‚îÄ‚îÄ */
.drawer-overlay {
  position: fixed; inset: 0; z-index: 300;
  pointer-events: none;
}
.drawer-overlay.open { pointer-events: all; }

.drawer-scrim {
  position: absolute; inset: 0;
  background: rgba(13,13,13,0.4);
  opacity: 0; transition: opacity 0.3s;
}
.drawer-overlay.open .drawer-scrim { opacity: 1; }

.drawer {
  position: absolute; right: 0; top: 0; bottom: 0;
  width: min(460px, 100%);
  background: var(--paper);
  border-left: 3px solid var(--ink);
  transform: translateX(100%);
  transition: transform 0.35s cubic-bezier(0.16,1,0.3,1);
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}
.drawer-overlay.open .drawer { transform: translateX(0); }

.d-top {
  padding: 2rem;
  position: relative;
  border-bottom: 2px solid var(--ink);
}

.d-close {
  position: absolute; top: 1rem; right: 1rem;
  background: none; border: 1px solid var(--rule);
  width: 30px; height: 30px;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: 0.9rem; color: var(--muted);
  transition: all 0.15s;
}
.d-close:hover { border-color: var(--ink); color: var(--ink); }

.d-type {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.6rem;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 0.5rem;
}

.d-amount {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 3.5rem;
  line-height: 1;
  letter-spacing: 0.02em;
  margin-bottom: 0.5rem;
}

.d-desc {
  font-size: 1.2rem;
  font-weight: 700;
  margin-bottom: 0.25rem;
}

.d-date {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.7rem;
  color: var(--muted);
  letter-spacing: 0.1em;
}

.d-body { padding: 1.5rem 2rem; flex: 1; }

.d-field {
  margin-bottom: 1.25rem;
  padding-bottom: 1.25rem;
  border-bottom: 1px solid var(--rule);
}
.d-field:last-child { border-bottom: none; }

.d-field-label {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.58rem;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 0.35rem;
}

.d-field-val {
  font-size: 0.9rem;
  line-height: 1.5;
}

.d-delete {
  display: block;
  width: 100%;
  margin-top: 1rem;
  background: none;
  border: 2px solid var(--red);
  color: var(--red);
  font-family: 'Bebas Neue', sans-serif;
  font-size: 1.1rem;
  letter-spacing: 0.1em;
  padding: 0.65rem;
  cursor: pointer;
  transition: all 0.15s;
}
.d-delete:hover { background: var(--red); color: white; }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast {
  position: fixed; bottom: 2rem; left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: var(--ink);
  color: var(--paper);
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.72rem;
  letter-spacing: 0.1em;
  padding: 0.75rem 1.5rem;
  border-left: 4px solid var(--gold);
  z-index: 999;
  transition: transform 0.3s cubic-bezier(0.16,1,0.3,1);
  white-space: nowrap;
}
.toast.show { transform: translateX(-50%) translateY(0); }
.toast.success { border-left-color: var(--lime); }
.toast.error { border-left-color: var(--red); }

/* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
@keyframes rowIn {
  from { opacity: 0; transform: translateX(-6px); }
  to   { opacity: 1; transform: translateX(0); }
}

@keyframes numPop {
  0%   { transform: scale(1); }
  50%  { transform: scale(1.06); }
  100% { transform: scale(1); }
}

.pop { animation: numPop 0.3s ease; }

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media (max-width: 900px) {
  .layout { grid-template-columns: 1fr; }
  .right-col { border-top: 2px solid var(--ink); }
  .hero { grid-template-columns: 1fr 1fr; }
  .hero-col:last-child { display: none; }
  .m-tag, .m-date { display: none; }
}
</style>
</head>
<body>

<!-- MASTHEAD -->
<header class="masthead">
  <div class="m-logo">LED<span class="dot">‚Ä¢</span>GER</div>
  <div class="m-tag">Personal Finance Tracker</div>
  <div class="m-date" id="todayDate"></div>
  <div class="m-balance">
    <div class="m-balance-label">Net Balance</div>
    <div class="m-balance-num" id="headerBalance">$0.00</div>
  </div>
</header>

<!-- HERO STATS BAND -->
<section class="hero">
  <div class="hero-col" id="incomeCol">
    <div class="h-label">Total Income</div>
    <div class="h-num income" id="heroIncome">$0</div>
    <div class="h-sub" id="incomeCount">0 transactions</div>
    <div class="h-bar"><div class="h-bar-fill" id="incomeBar" style="width:0%"></div></div>
  </div>
  <div class="hero-col" id="expenseCol">
    <div class="h-label">Total Expenses</div>
    <div class="h-num expense" id="heroExpense">$0</div>
    <div class="h-sub" id="expenseCount">0 transactions</div>
    <div class="h-bar"><div class="h-bar-fill" id="expenseBar" style="width:0%"></div></div>
  </div>
  <div class="hero-col" id="netCol">
    <div class="h-label">Net This Month</div>
    <div class="h-num net pos" id="heroNet">$0</div>
    <div class="h-sub" id="netSub">No transactions yet</div>
    <div class="h-bar"><div class="h-bar-fill" id="netBar" style="width:50%"></div></div>
  </div>
</section>

<!-- MAIN LAYOUT -->
<div class="layout">

  <!-- LEFT: TRANSACTIONS -->
  <div class="ledger-col">
    <div class="col-header">
      <div class="col-hed">
        TRANSACTIONS
        <span class="count-pill" id="txCount">0</span>
      </div>
      <div class="col-controls">
        <select class="ctrl-select" id="filterCat" onchange="renderTable()">
          <option value="all">All Categories</option>
          <option value="income">Income</option>
          <option value="food">Food</option>
          <option value="transport">Transport</option>
          <option value="home">Home</option>
          <option value="health">Health</option>
          <option value="leisure">Leisure</option>
          <option value="shopping">Shopping</option>
          <option value="savings">Savings</option>
          <option value="other">Other</option>
        </select>
        <select class="ctrl-select" id="sortTx" onchange="renderTable()">
          <option value="date-desc">Newest First</option>
          <option value="date-asc">Oldest First</option>
          <option value="amount-desc">Largest First</option>
          <option value="amount-asc">Smallest First</option>
        </select>
        <button class="ctrl-btn" onclick="exportCSV()">‚Üì CSV</button>
        <button class="ctrl-btn" onclick="clearAll()">‚úï Clear</button>
      </div>
    </div>

    <div id="tableWrap">
      <div class="empty-state show" id="emptyState">
        <div class="empty-hed">NO ENTRIES YET</div>
        <div class="empty-sub">Add your first transaction using the form ‚Üí</div>
      </div>
      <table class="tx-table" id="txTable" style="display:none">
        <thead>
          <tr>
            <th>Date</th>
            <th>Category</th>
            <th>Description</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody id="txBody"></tbody>
      </table>
    </div>
  </div>

  <!-- RIGHT PANEL -->
  <div class="right-col">

    <!-- ADD FORM -->
    <div class="add-form">
      <div class="form-hed">ADD <span class="gold">ENTRY</span></div>

      <div class="type-toggle">
        <button class="type-btn active exp" id="btnExp" onclick="setType('expense')">‚àí Expense</button>
        <button class="type-btn inc" id="btnInc" onclick="setType('income')">+ Income</button>
      </div>

      <div class="form-row">
        <label class="form-label">Description</label>
        <input type="text" class="form-input" id="fDesc" placeholder="e.g. Grocery run, Rent, Salary‚Ä¶">
      </div>

      <div class="amount-row">
        <div class="form-row">
          <label class="form-label">Amount ($)</label>
          <input type="number" class="form-input" id="fAmount" placeholder="0.00" min="0" step="0.01">
        </div>
        <div class="form-row">
          <label class="form-label">Date</label>
          <input type="date" class="form-input" id="fDate">
        </div>
      </div>

      <div class="form-row">
        <label class="form-label">Category</label>
        <select class="form-select" id="fCat">
          <option value="food">üçΩ Food & Drink</option>
          <option value="transport">üöå Transport</option>
          <option value="home">üè† Home & Bills</option>
          <option value="health">üíä Health</option>
          <option value="leisure">üé≠ Leisure</option>
          <option value="shopping">üõç Shopping</option>
          <option value="savings">üí∞ Savings</option>
          <option value="other">¬∑ Other</option>
        </select>
      </div>

      <div class="form-row">
        <label class="form-label">Note (optional)</label>
        <input type="text" class="form-input" id="fNote" placeholder="Any extra detail‚Ä¶">
      </div>

      <button class="form-submit" onclick="addTransaction()">RECORD ENTRY ‚Üí</button>
    </div>

    <!-- CHARTS -->
    <div class="charts-area">

      <!-- Budget Health -->
      <div class="chart-block">
        <div class="chart-hed">Budget Health <span id="healthPct">‚Äì</span></div>
        <div class="health-meter">
          <div class="health-top">
            <div class="health-score" id="healthScore">‚Äì</div>
            <div class="health-label" id="healthLabel">Add transactions<br>to see your score</div>
          </div>
          <div class="health-track">
            <div class="health-fill" id="healthFill" style="width:0%"></div>
          </div>
          <div class="health-tips" id="healthTip">Your financial health score will appear here once you've logged some entries.</div>
        </div>
      </div>

      <!-- Spending by Category -->
      <div class="chart-block">
        <div class="chart-hed">Spending by Category</div>
        <div id="catBars">
          <div style="font-size:0.8rem;color:var(--muted);font-style:italic">No expense data yet.</div>
        </div>
      </div>

      <!-- Monthly Trend -->
      <div class="chart-block">
        <div class="chart-hed">Income vs Expenses ‚Äî 6 Month Trend</div>
        <div class="sparkline-wrap">
          <canvas id="trendCanvas"></canvas>
        </div>
        <div style="display:flex;gap:1.5rem;margin-top:0.5rem">
          <span style="font-family:'IBM Plex Mono',monospace;font-size:0.6rem;color:var(--lime)">‚ñ† Income</span>
          <span style="font-family:'IBM Plex Mono',monospace;font-size:0.6rem;color:var(--red)">‚ñ† Expenses</span>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="chart-block">
        <div class="chart-hed">Quick Stats</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.75rem" id="quickStats">
          <div style="background:var(--mid);padding:0.85rem;border:1px solid var(--rule)">
            <div style="font-family:'IBM Plex Mono',monospace;font-size:0.55rem;letter-spacing:0.18em;text-transform:uppercase;color:var(--muted);margin-bottom:0.3rem">Avg Expense</div>
            <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--red)" id="avgExpense">$0</div>
          </div>
          <div style="background:var(--mid);padding:0.85rem;border:1px solid var(--rule)">
            <div style="font-family:'IBM Plex Mono',monospace;font-size:0.55rem;letter-spacing:0.18em;text-transform:uppercase;color:var(--muted);margin-bottom:0.3rem">Avg Income</div>
            <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--lime)" id="avgIncome">$0</div>
          </div>
          <div style="background:var(--mid);padding:0.85rem;border:1px solid var(--rule)">
            <div style="font-family:'IBM Plex Mono',monospace;font-size:0.55rem;letter-spacing:0.18em;text-transform:uppercase;color:var(--muted);margin-bottom:0.3rem">Biggest Spend</div>
            <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--ink)" id="bigSpend">$0</div>
          </div>
          <div style="background:var(--mid);padding:0.85rem;border:1px solid var(--rule)">
            <div style="font-family:'IBM Plex Mono',monospace;font-size:0.55rem;letter-spacing:0.18em;text-transform:uppercase;color:var(--muted);margin-bottom:0.3rem">Savings Rate</div>
            <div style="font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--green)" id="savingsRate">0%</div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- DETAIL DRAWER -->
<div class="drawer-overlay" id="drawerOverlay">
  <div class="drawer-scrim" onclick="closeDrawer()"></div>
  <div class="drawer" id="drawer"></div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE & STORAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let transactions = JSON.parse(localStorage.getItem('ledger_txs') || '[]');
let currentType = 'expense';
let selectedId = null;

const CAT_COLORS = {
  food:      '#D4A017',
  transport: '#1A3A6B',
  home:      '#8B5E3C',
  health:    '#2D7A6A',
  income:    '#1E4D2B',
  leisure:   '#7B3FB0',
  shopping:  '#C8321A',
  savings:   '#1A5C8A',
  other:     '#7A7065',
};

const CAT_ICONS = {
  food:'üçΩ', transport:'üöå', home:'üè†', health:'üíä',
  income:'üíµ', leisure:'üé≠', shopping:'üõç', savings:'üí∞', other:'¬∑'
};

function save() {
  localStorage.setItem('ledger_txs', JSON.stringify(transactions));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('todayDate').textContent =
    new Date().toLocaleDateString('en-US', { weekday:'short', year:'numeric', month:'short', day:'numeric' }).toUpperCase();

  document.getElementById('fDate').value = new Date().toISOString().split('T')[0];

  // Seed with sample data if empty
  if (transactions.length === 0) seedSampleData();

  renderAll();

  document.getElementById('fDesc').addEventListener('keydown', e => {
    if (e.key === 'Enter') addTransaction();
  });
  document.getElementById('fAmount').addEventListener('keydown', e => {
    if (e.key === 'Enter') addTransaction();
  });
});

function seedSampleData() {
  const now = new Date();
  const mo = (offset) => {
    const d = new Date(now);
    d.setDate(d.getDate() - offset);
    return d.toISOString().split('T')[0];
  };

  const samples = [
    { type:'income',  desc:'Monthly Salary',        cat:'income',    amount:4200, date:mo(1),  note:'Direct deposit' },
    { type:'income',  desc:'Freelance Project',      cat:'income',    amount:850,  date:mo(8),  note:'Logo design work' },
    { type:'expense', desc:'Rent',                   cat:'home',      amount:1350, date:mo(2),  note:'Monthly rent' },
    { type:'expense', desc:'Whole Foods Groceries',  cat:'food',      amount:127,  date:mo(3),  note:'' },
    { type:'expense', desc:'Electric Bill',          cat:'home',      amount:68,   date:mo(5),  note:'' },
    { type:'expense', desc:'Monthly Gym',            cat:'health',    amount:45,   date:mo(4),  note:'Planet Fitness' },
    { type:'expense', desc:'Netflix',                cat:'leisure',   amount:15.99,date:mo(6),  note:'Streaming' },
    { type:'expense', desc:'Uber to Airport',        cat:'transport', amount:38,   date:mo(7),  note:'' },
    { type:'expense', desc:'Birthday Dinner',        cat:'food',      amount:94,   date:mo(9),  note:'Chez Margot' },
    { type:'expense', desc:'New Running Shoes',      cat:'shopping',  amount:130,  date:mo(10), note:'Nike Air Zoom' },
    { type:'expense', desc:'Metro Card',             cat:'transport', amount:33,   date:mo(11), note:'Monthly pass' },
    { type:'savings', desc:'Emergency Fund',         cat:'savings',   amount:300,  date:mo(12), note:'Auto-transfer' },
    { type:'expense', desc:'Coffee & Pastries',      cat:'food',      amount:22,   date:mo(13), note:'Daily Grounds' },
    { type:'expense', desc:'Spotify Premium',        cat:'leisure',   amount:10.99,date:mo(14), note:'' },
    { type:'expense', desc:'Doctor Visit Copay',     cat:'health',    amount:30,   date:mo(15), note:'' },
    { type:'income',  desc:'Bonus Payment',          cat:'income',    amount:500,  date:mo(16), note:'Q1 performance' },
    { type:'expense', desc:'IKEA Shelving',          cat:'home',      amount:89,   date:mo(18), note:'' },
    { type:'expense', desc:'Date Night',             cat:'leisure',   amount:75,   date:mo(20), note:'Movies + dinner' },
    { type:'expense', desc:'Pharmacy',               cat:'health',    amount:24,   date:mo(21), note:'Vitamins' },
    { type:'expense', desc:'Takeout Thai',           cat:'food',      amount:35,   date:mo(22), note:'Golden Tiger' },
  ];

  transactions = samples.map((s, i) => ({ ...s, id: Date.now() + i }));
  save();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADD TRANSACTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setType(t) {
  currentType = t;
  document.getElementById('btnExp').classList.toggle('active', t === 'expense');
  document.getElementById('btnInc').classList.toggle('active', t === 'income');

  // Auto-set category for income
  if (t === 'income') document.getElementById('fCat').value = 'income';
  else if (document.getElementById('fCat').value === 'income')
    document.getElementById('fCat').value = 'food';
}

function addTransaction() {
  const desc   = document.getElementById('fDesc').value.trim();
  const amount = parseFloat(document.getElementById('fAmount').value);
  const date   = document.getElementById('fDate').value;
  const cat    = document.getElementById('fCat').value;
  const note   = document.getElementById('fNote').value.trim();

  if (!desc)   { showToast('Please enter a description', 'error'); return; }
  if (!amount || amount <= 0) { showToast('Please enter a valid amount', 'error'); return; }
  if (!date)   { showToast('Please select a date', 'error'); return; }

  const tx = { id: Date.now(), type: currentType, desc, amount, date, cat, note };
  transactions.unshift(tx);
  save();

  // Reset form
  document.getElementById('fDesc').value = '';
  document.getElementById('fAmount').value = '';
  document.getElementById('fNote').value = '';

  renderAll();
  showToast(`${currentType === 'income' ? '+ Income' : '‚àí Expense'} recorded`, 'success');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER ALL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAll() {
  renderTable();
  renderStats();
  renderCatBars();
  renderTrend();
  renderHealthScore();
  renderQuickStats();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER TABLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getFiltered() {
  const catF = document.getElementById('filterCat').value;
  const sort  = document.getElementById('sortTx').value;

  let list = [...transactions];
  if (catF !== 'all') list = list.filter(t => t.cat === catF || (catF === 'income' && t.type === 'income'));

  list.sort((a, b) => {
    if (sort === 'date-desc')   return new Date(b.date) - new Date(a.date);
    if (sort === 'date-asc')    return new Date(a.date) - new Date(b.date);
    if (sort === 'amount-desc') return b.amount - a.amount;
    if (sort === 'amount-asc')  return a.amount - b.amount;
    return 0;
  });
  return list;
}

function renderTable() {
  const list = getFiltered();
  const empty = document.getElementById('emptyState');
  const table = document.getElementById('txTable');
  const body  = document.getElementById('txBody');
  const count = document.getElementById('txCount');

  count.textContent = list.length;

  if (list.length === 0) {
    empty.classList.add('show');
    table.style.display = 'none';
    return;
  }

  empty.classList.remove('show');
  table.style.display = 'table';
  body.innerHTML = '';

  list.forEach((tx, i) => {
    const isInc = tx.type === 'income';
    const catCls = `cat-${tx.cat}`;
    const d = new Date(tx.date + 'T12:00:00');
    const dateStr = d.toLocaleDateString('en-US', { month:'short', day:'numeric', year:'2-digit' });

    const tr = document.createElement('tr');
    tr.className = 'tx-row' + (tx.id === selectedId ? ' selected' : '');
    tr.style.animationDelay = `${Math.min(i * 0.025, 0.4)}s`;
    tr.dataset.id = tx.id;
    tr.onclick = () => openDrawer(tx);

    tr.innerHTML = `
      <td><span class="tx-date">${dateStr}</span></td>
      <td><span class="tx-cat ${catCls}">${CAT_ICONS[tx.cat] || '¬∑'} ${tx.cat}</span></td>
      <td>
        <div class="tx-desc">${tx.desc}</div>
        ${tx.note ? `<div class="tx-note">${tx.note}</div>` : ''}
      </td>
      <td>
        <span class="tx-amount ${isInc ? 'inc' : 'exp'}">
          ${isInc ? '+' : '‚àí'}$${tx.amount.toFixed(2)}
        </span>
      </td>
    `;

    body.appendChild(tr);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER STATS BAND
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderStats() {
  const income  = transactions.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
  const expense = transactions.filter(t => t.type !== 'income').reduce((s, t) => s + t.amount, 0);
  const net = income - expense;
  const max = Math.max(income, expense, 1);

  animNum('heroIncome', income, '$');
  animNum('heroExpense', expense, '$');
  animNum('heroNet', Math.abs(net), '$', net < 0 ? '‚àí' : net > 0 ? '+' : '');

  const netEl = document.getElementById('heroNet');
  netEl.className = 'h-num net ' + (net >= 0 ? 'pos' : 'neg');

  document.getElementById('incomeCount').textContent = transactions.filter(t=>t.type==='income').length + ' transactions';
  document.getElementById('expenseCount').textContent = transactions.filter(t=>t.type!=='income').length + ' transactions';
  document.getElementById('netSub').textContent = net >= 0 ? 'Under budget ‚úì' : 'Over budget ‚úó';

  // Header balance
  const hb = document.getElementById('headerBalance');
  hb.textContent = (net < 0 ? '‚àí' : '') + '$' + Math.abs(net).toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
  hb.className = 'm-balance-num' + (net < 0 ? ' neg' : '');

  setTimeout(() => {
    document.getElementById('incomeBar').style.width  = (income  / max * 100) + '%';
    document.getElementById('expenseBar').style.width = (expense / max * 100) + '%';
    document.getElementById('netBar').style.width = Math.min(Math.abs(net) / max * 100, 100) + '%';
  }, 100);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CATEGORY BARS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderCatBars() {
  const expenses = transactions.filter(t => t.type !== 'income');
  const totals = {};
  expenses.forEach(t => { totals[t.cat] = (totals[t.cat] || 0) + t.amount; });

  const sorted = Object.entries(totals).sort((a,b) => b[1] - a[1]);
  const maxAmt = sorted[0]?.[1] || 1;
  const container = document.getElementById('catBars');

  if (sorted.length === 0) {
    container.innerHTML = '<div style="font-size:0.8rem;color:var(--muted);font-style:italic">No expense data yet.</div>';
    return;
  }

  container.innerHTML = sorted.map(([cat, amt]) => `
    <div class="cat-bar-row">
      <div class="cat-bar-label">${cat}</div>
      <div class="cat-bar-track">
        <div class="cat-bar-fill" style="width:0%;background:${CAT_COLORS[cat]||'#888'}" data-pct="${(amt/maxAmt*100).toFixed(1)}"></div>
      </div>
      <div class="cat-bar-amt">$${amt.toFixed(0)}</div>
    </div>
  `).join('');

  // Animate bars
  setTimeout(() => {
    container.querySelectorAll('.cat-bar-fill').forEach(el => {
      el.style.width = el.dataset.pct + '%';
    });
  }, 100);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TREND CHART (canvas sparkline)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderTrend() {
  const canvas = document.getElementById('trendCanvas');
  const ctx = canvas.getContext('2d');
  const W = canvas.offsetWidth || 340;
  const H = canvas.offsetHeight || 80;
  canvas.width = W * devicePixelRatio;
  canvas.height = H * devicePixelRatio;
  ctx.scale(devicePixelRatio, devicePixelRatio);

  // Build last 6 months buckets
  const months = [];
  for (let i = 5; i >= 0; i--) {
    const d = new Date();
    d.setMonth(d.getMonth() - i);
    months.push({ key: `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`, label: d.toLocaleDateString('en-US',{month:'short'}), inc:0, exp:0 });
  }

  transactions.forEach(t => {
    const key = t.date.substring(0, 7);
    const mo = months.find(m => m.key === key);
    if (!mo) return;
    if (t.type === 'income') mo.inc += t.amount;
    else mo.exp += t.amount;
  });

  const maxVal = Math.max(...months.map(m => Math.max(m.inc, m.exp)), 1);
  const pad = { top:10, bottom:24, left:10, right:10 };
  const chartW = W - pad.left - pad.right;
  const chartH = H - pad.top - pad.bottom;
  const step = chartW / (months.length - 1);

  ctx.clearRect(0, 0, W, H);

  // Grid lines
  ctx.strokeStyle = 'rgba(212,201,188,0.5)';
  ctx.lineWidth = 1;
  [0.25, 0.5, 0.75, 1].forEach(pct => {
    const y = pad.top + chartH * (1 - pct);
    ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(W - pad.right, y); ctx.stroke();
  });

  const drawLine = (data, color, fill) => {
    const pts = months.map((m, i) => ({
      x: pad.left + i * step,
      y: pad.top + chartH * (1 - m[data] / maxVal)
    }));

    // Fill area
    ctx.beginPath();
    ctx.moveTo(pts[0].x, H - pad.bottom);
    pts.forEach(p => ctx.lineTo(p.x, p.y));
    ctx.lineTo(pts[pts.length-1].x, H - pad.bottom);
    ctx.closePath();
    ctx.fillStyle = fill;
    ctx.fill();

    // Line
    ctx.beginPath();
    pts.forEach((p, i) => i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y));
    ctx.strokeStyle = color;
    ctx.lineWidth = 2;
    ctx.stroke();

    // Dots
    pts.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, 3, 0, Math.PI*2);
      ctx.fillStyle = color;
      ctx.fill();
    });
  };

  drawLine('exp', '#C8321A', 'rgba(200,50,26,0.08)');
  drawLine('inc', '#A8C84A', 'rgba(168,200,74,0.12)');

  // Month labels
  ctx.font = `${10 * devicePixelRatio / devicePixelRatio}px IBM Plex Mono`;
  ctx.fillStyle = '#7A7065';
  ctx.textAlign = 'center';
  months.forEach((m, i) => {
    ctx.fillText(m.label.toUpperCase(), pad.left + i * step, H - 6);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HEALTH SCORE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderHealthScore() {
  const income  = transactions.filter(t => t.type === 'income').reduce((s,t) => s+t.amount, 0);
  const expense = transactions.filter(t => t.type !== 'income').reduce((s,t) => s+t.amount, 0);
  const savings = transactions.filter(t => t.cat === 'savings').reduce((s,t) => s+t.amount, 0);

  if (transactions.length === 0) return;

  let score = 50;
  if (income > 0) {
    const ratio = expense / income;
    if (ratio < 0.5)  score = 90;
    else if (ratio < 0.7) score = 75;
    else if (ratio < 0.9) score = 60;
    else if (ratio < 1.0) score = 45;
    else score = 25;
    if (savings > 0) score = Math.min(score + 10, 99);
  }

  const label = score >= 80 ? 'EXCELLENT' : score >= 65 ? 'GOOD' : score >= 45 ? 'FAIR' : 'AT RISK';
  const cls = score >= 65 ? '' : score >= 45 ? 'warn' : 'danger';
  const tips = {
    '': 'Solid financial health. Keep building that savings buffer.',
    warn: 'Expenses are approaching income. Look for cuts in leisure and shopping.',
    danger: 'Spending exceeds or nearly matches income. Time to review subscriptions and non-essentials.'
  }[cls];

  document.getElementById('healthScore').textContent = score;
  document.getElementById('healthScore').className = 'health-score ' + cls;
  document.getElementById('healthLabel').textContent = label + '\nFinancial Health';
  document.getElementById('healthPct').textContent = score + '/99';
  document.getElementById('healthTip').textContent = tips;

  const fill = document.getElementById('healthFill');
  fill.className = 'health-fill ' + cls;
  setTimeout(() => { fill.style.width = score + '%'; }, 100);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// QUICK STATS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderQuickStats() {
  const exp = transactions.filter(t => t.type !== 'income');
  const inc = transactions.filter(t => t.type === 'income');
  const income  = inc.reduce((s,t) => s+t.amount, 0);
  const expense = exp.reduce((s,t) => s+t.amount, 0);

  const avgExp = exp.length ? expense / exp.length : 0;
  const avgInc = inc.length ? income  / inc.length : 0;
  const big = exp.length ? Math.max(...exp.map(t=>t.amount)) : 0;
  const savings = income > 0 ? Math.max(0, (income - expense) / income * 100) : 0;

  document.getElementById('avgExpense').textContent = '$' + avgExp.toFixed(0);
  document.getElementById('avgIncome').textContent  = '$' + avgInc.toFixed(0);
  document.getElementById('bigSpend').textContent   = '$' + big.toFixed(0);
  document.getElementById('savingsRate').textContent = savings.toFixed(0) + '%';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DETAIL DRAWER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openDrawer(tx) {
  selectedId = tx.id;
  renderTable(); // re-highlight

  const isInc = tx.type === 'income';
  const d = new Date(tx.date + 'T12:00:00');
  const dateStr = d.toLocaleDateString('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
  const amountColor = isInc ? 'var(--lime)' : 'var(--red)';

  document.getElementById('drawer').innerHTML = `
    <div class="d-top">
      <button class="d-close" onclick="closeDrawer()">‚úï</button>
      <div class="d-type">${CAT_ICONS[tx.cat]} ${tx.cat.toUpperCase()} ¬∑ ${tx.type.toUpperCase()}</div>
      <div class="d-amount" style="color:${amountColor}">
        ${isInc ? '+' : '‚àí'}$${tx.amount.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}
      </div>
      <div class="d-desc">${tx.desc}</div>
      <div class="d-date">${dateStr}</div>
    </div>
    <div class="d-body">
      <div class="d-field">
        <div class="d-field-label">Transaction Type</div>
        <div class="d-field-val">${isInc ? '+ Income' : '‚àí Expense'}</div>
      </div>
      <div class="d-field">
        <div class="d-field-label">Category</div>
        <div class="d-field-val"><span class="tx-cat cat-${tx.cat}">${CAT_ICONS[tx.cat]} ${tx.cat}</span></div>
      </div>
      ${tx.note ? `
      <div class="d-field">
        <div class="d-field-label">Note</div>
        <div class="d-field-val" style="font-style:italic;color:var(--muted)">${tx.note}</div>
      </div>` : ''}
      <div class="d-field">
        <div class="d-field-label">% of Total ${isInc ? 'Income' : 'Expenses'}</div>
        <div class="d-field-val">${getPct(tx)}% of all ${isInc ? 'income' : 'expenses'}</div>
      </div>
      <div class="d-field">
        <div class="d-field-label">Recorded ID</div>
        <div class="d-field-val" style="font-family:'IBM Plex Mono',monospace;font-size:0.7rem;color:var(--muted)">#${tx.id}</div>
      </div>
      <button class="d-delete" onclick="deleteTransaction(${tx.id})">‚úï DELETE THIS ENTRY</button>
    </div>
  `;

  document.getElementById('drawerOverlay').classList.add('open');
}

function closeDrawer() {
  document.getElementById('drawerOverlay').classList.remove('open');
  selectedId = null;
  document.querySelectorAll('.tx-row.selected').forEach(r => r.classList.remove('selected'));
}

function deleteTransaction(id) {
  transactions = transactions.filter(t => t.id !== id);
  save();
  closeDrawer();
  renderAll();
  showToast('Entry deleted');
}

function getPct(tx) {
  const isInc = tx.type === 'income';
  const total = transactions.filter(t => isInc ? t.type === 'income' : t.type !== 'income').reduce((s,t) => s+t.amount, 0);
  return total ? (tx.amount / total * 100).toFixed(1) : '0.0';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILITIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function animNum(id, target, prefix='', sign='') {
  const el = document.getElementById(id);
  if (!el) return;
  const formatted = prefix + target.toLocaleString('en-US', { minimumFractionDigits:0, maximumFractionDigits:0 });
  el.textContent = sign + formatted;
  el.classList.remove('pop');
  void el.offsetWidth;
  el.classList.add('pop');
}

function clearAll() {
  if (!confirm('Clear all transactions? This cannot be undone.')) return;
  transactions = [];
  save();
  renderAll();
  showToast('All entries cleared');
}

function exportCSV() {
  if (transactions.length === 0) { showToast('No data to export', 'error'); return; }
  const header = 'Date,Type,Category,Description,Note,Amount';
  const rows = transactions.map(t =>
    `${t.date},${t.type},${t.cat},"${t.desc}","${t.note||''}",${t.type==='income'?t.amount:-t.amount}`
  );
  const csv = [header, ...rows].join('\n');
  const blob = new Blob([csv], { type: 'text/csv' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `ledger-${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  showToast('CSV exported ‚úì', 'success');
}

function showToast(msg, type='') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast show ' + type;
  clearTimeout(t._timer);
  t._timer = setTimeout(() => t.className = 'toast', 3000);
}

// Re-render trend on resize
window.addEventListener('resize', () => renderTrend());
</script>
</body>
</html>
